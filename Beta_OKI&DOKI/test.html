<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Hi Land !</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js">
    </script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>

<body>
    <script type="text/javascript">

        var keyA;
        var keyZ;
        var keyE
        var player;
        
        var cursors; // variable pour le cursors
        var gameOver
        var pologlace = true
        var changecaract = false
        var score=0
        var scoretext
        var PV=2
        var protectionglace = 0
        var scoreText
        var graphics
        var doublejump = 0
        var repousseright = false
        var repousseleft = false
        var attaque = false
        var lanceattack = true
        var turnprojo = false
        var tombe1 = false
        var safe = false
        var tempsdegats = false
        var EnnemiUnFollow = false
        var Ennemi2Follow = false
        var Ennemi3Follow = false
        var Ennemi4Follow = false
        var ennemipattern1 = true
        var ennemipattern2 = true
        var zoneprojo = false
        var activationmissile = false
        var activationgrandrond = false





                        class test extends Phaser.Scene {


                constructor() {

                    super("test")
                }




                preload() {
                        // chargement du personnage
                    this.load.spritesheet("dude", "assets/Polo.png", {
                        frameWidth: 32,
                        frameHeight: 64
                    });

                    this.load.spritesheet("dude2", "assets/Pologlace.png", {
                        frameWidth: 32,
                        frameHeight: 64
                    });

                    this.load.spritesheet("dudeglace", "assets/Pologlace.png", {
                        frameWidth: 32,
                        frameHeight: 64
                    });



                    this.load.spritesheet("bitcoin", "assets/bitcoin.png", {
                        frameWidth: 32,
                        frameHeight: 32,
                    });

                    this.load.spritesheet("dossier", "assets/dossier.png", {
                        frameWidth: 32,
                        frameHeight: 32,
                    });


                    this.load.spritesheet("click", "assets/click.png", {
                        frameWidth: 32,
                        frameHeight: 32,
                    });
                    this.load.spritesheet("porte", "assets/portes.png", {
                        frameWidth: 64,
                        frameHeight: 64,
                    });

                    this.load.spritesheet("zoneattack", "assets/attack.png", {
                        frameWidth: 64,
                        frameHeight: 64,
                    });

                    this.load.spritesheet("projo", "assets/projo.png", {
                        frameWidth: 370,
                        frameHeight: 109,
                    });

                    this.load.spritesheet("obscur", "assets/obscur.png", {
                        frameWidth: 371,
                        frameHeight: 207,
                    });
                    // chargement tuiles de jeu
                    this.load.image("Phaser_Tileset", "assets/Tileset.png");

                    // chargement de la carte
                    this.load.tilemapTiledJSON("carte", "assets/Monniveau.json");

                    this.load.image("interfacefenetre", "assets/fenetre clean.png" );

                    this.load.image("interfacenormal", "assets/interface full.png" );

                    this.load.image("interfacedegats", "assets/interface degats.png" );
                    this.load.spritesheet("virus", "assets/mobile.png", {
                        frameWidth: 32,
                        frameHeight: 32,
                    });
                    this.load.image('nuit', 'assets/nuit.png');
                    

                }


                create() {
                        // chargement de la carte du niveau
                        const carteDuNiveau = this.add.tilemap("carte");
                        // chargement du jeu de tuiles
                        const tileset = carteDuNiveau.addTilesetImage(
                        "Placeholder",
                        "Phaser_Tileset"
                        );


                        // chargement du calque "calque_backgroung"
                        const deco = carteDuNiveau.createStaticLayer(
                        "Background",
                        tileset
                        );



                        // chargement du calque "calque_plateformes""
                        const plateformes = carteDuNiveau.createStaticLayer(
                        "Plateformes",
                        tileset
                        );

                        // chargement du calque "calque_plateformes""
                        const grimpette = carteDuNiveau.createStaticLayer(
                        "grimpette",
                        tileset
                        );



                        //affichage de l'interface
                        this.add.image(120,75, "interfacefenetre").setScrollFactor(0);
                        this.add.image(120,75, "interfacenormal").setScrollFactor(0);
                        //affiche un texte à l’écran, pour le score
                        
                        scoreText=this.add.text(175,100,'0',{fontSize:'32px',fill:'#000'}).setScrollFactor(0);

                        
                        var doublejump = 0
                        

                        // définition des objets solides avec lesquels le personnage va interagir
                        plateformes.setCollisionByProperty({ solide: true });
                        grimpette.setCollisionByProperty({ grimpe: true });

                        // création du personnage de jeu et positionnement
                        player = this.physics.add.sprite(100,1490,"dude");
                        
                        keyA = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
                        keyZ = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Z);

                        // ajout du modèle de collision entre le personnage et les plates-formes et les ennemis et les piques
                        this.physics.add.collider(player, plateformes);
                        this.physics.add.collider(player, grimpette,this.escalade);
                        

                        gameOver = false;



                        // ajout du modèle de collision entre le personnage et le monde
                        player.setCollideWorldBounds(true);

                        
                        

                        // animation du perso pour tourner à gauche
                        this.anims.create({
                        key: "left",
                        frames: this.anims.generateFrameNumbers("dude", { start: 0, end: 3 }),
                        frameRate: 10,
                        repeat: -1
                        });

                        // animation du perso lorsque le personnage n'avance pas
                        this.anims.create({
                        key: "turn",
                        frames: [{ key: "dude", frame: 4 }],
                        frameRate: 20
                        });

                        // animation du perso pour tourner à droite
                        this.anims.create({
                        key: "right",
                        frames: this.anims.generateFrameNumbers("dude", { start: 5, end: 8 }),
                        frameRate: 10,
                        repeat: -1
                        });


                        //animation des portes
                        this.anims.create({
                        key: "portesoleilouverte",
                        frames: this.anims.generateFrameNumbers("porte", { start: 1, end: 1 }),
                        frameRate: 10,
                        });
                        this.anims.create({
                        key: "portesoleilfermee",
                        frames: this.anims.generateFrameNumbers("porte", { start: 0, end: 0 }),
                        frameRate: 10,
                        });

                        this.anims.create({
                        key: "porteluneouverte",
                        frames: this.anims.generateFrameNumbers("porte", { start: 3}),
                        frameRate: 10,
                        
                        });
                        this.anims.create({
                        key: "portelunefermee",
                        frames: this.anims.generateFrameNumbers("porte", { start: 1, end: 1 }),
                        frameRate: 10,
                        });


                        this.portesoleil = this.physics.add.sprite(200,1503,"porte");
                        this.portesoleil.setImmovable();
                        this.portesoleil.body.setAllowGravity(false)
                        this.physics.add.collider(player, this.portesoleil);

                        this.portelune = this.physics.add.sprite(300,1503,"porte");
                        this.portelune.setImmovable();
                        this.portelune.body.setAllowGravity(false)
                        this.physics.add.collider(player, this.portelune);

                        this.zoneattack = this.physics.add.sprite(100,1400,"zoneattack");
                        this.zoneattack.setCircle(48);
                        this.zoneattack.setImmovable();
                        this.zoneattack.body.setAllowGravity(false)
                        
                        










                        this.anims.create({
                        key: "leftg",
                        frames: this.anims.generateFrameNumbers("dude", { start: 9, end:12 }),
                        frameRate: 10,
                        repeat: -1
                        });

                        // animation du perso lorsque le personnage n'avance pas
                        this.anims.create({
                        key: "turng",
                        frames: [{ key: "dude", frame: 13 }],
                        frameRate: 20
                        });

                        // animation du perso pour tourner à droite
                        this.anims.create({
                        key: "rightg",
                        frames: this.anims.generateFrameNumbers("dude", { start: 15, end: 18 }),
                        frameRate: 10,
                        repeat: -1
                        });

                        





                        // création d'un écouteur sur le cursors
                        cursors = this.input.keyboard.createCursorKeys();

                        // redimentionnement du monde avec les dimensions calculées via tiled
                        this.physics.world.setBounds(0, 0, 9248, 3264);
                        //  ajout du champs de la caméra de taille identique à celle du monde
                        this.cameras.main.setBounds(0, 0, 9248, 3264);
                        // ancrage de la caméra sur le joueur
                        this.cameras.main.startFollow(player); 


                        this.anims.create({
                        key: 'virusactif',
                        frames: this.anims.generateFrameNumbers('virus', { start: 0, end: 1 }),
                        frameRate: 10,
                        repeat: -1
                        });

                        var startPoint = new Phaser.Math.Vector2(800, 630);
                        var controlPoint1 = new Phaser.Math.Vector2(1000, 630);
                        var controlPoint2 = new Phaser.Math.Vector2(1250, 630);
                        var endPoint = new Phaser.Math.Vector2(1700, 630);

                        var curve = new Phaser.Curves.CubicBezier(startPoint, controlPoint1, controlPoint2, endPoint);

                        var graphics = this.add.graphics();



                        this.followvirus = this.add.follower(curve, 500, 1500, 'virus').setInteractive();
                        this.physics.add.existing(this.followvirus);
                        this.followvirus.body.setAllowGravity(false)
                        this.followvirus.anims.play('virusactif', true)
                        var shape = new Phaser.Geom.Circle(96,96,96);
                        this.followvirus.setInteractive(shape, Phaser.Geom.Circle.Contains);
                        this.followvirus.setSize(32, 32);
                        this.physics.add.collider(player, this.followvirus,this.degats,null,this);
                        this.physics.add.collider(this.zoneattack, this.followvirus,this.degatsennemi,null,this);
                        

                        this.followvirus.startFollow({
                            duration: 5000,
                            yoyo: true,
                            ease: 'Sine.easeInOut',
                            repeat : -1
                        });


                        this.nuit = this.add.sprite(550, 475, 'nuit').setScrollFactor(0);
                        this.nuit.alpha = 0.8;
                        this.nuit.visible = false;

                        //ajout popcorn
                        this.bitcoin = this.physics.add.sprite(215, 1510, "bitcoin");
                        this.bitcoin.body.allowGravity = false
                        this.physics.add.collider(player, this.bitcoin, this.collectpop, null, this);

                        this.projo = this.physics.add.sprite(400,1300,"projo");
                        this.projo.setImmovable();
                        this.projo.body.setAllowGravity(false);
                        this.projo.setSize(50, 370);
                        this.projo.setOffset(30,0);
                        this.physics.add.collider(player, this.projo,this.degats,null,this);
                        

                        this.obscur = this.physics.add.sprite(700,1450,"obscur");
                        this.obscur.setImmovable();
                        this.obscur.body.setAllowGravity(false);
                        this.obscur.setOffset(0,0);
                        this.physics.add.collider(player, this.obscur,this.degats,null,this);


                        


                }

                update() {



                    if(turnprojo == true){
                        this.projo.rotation += 0.01;
                        this.projo.angle +=0.01;
                        setTimeout(() => {
                        turnprojo = false
                                    }, 600);
                    }

                    if(turnprojo == false){
                        this.projo.rotation -= 0.01;
                        setTimeout(() => {
                        turnprojo = true
                                    }, 600);
                    }


                        
                        scoreText.setText(PV)
                        console.log(pologlace)

                        

                    if (keyA.isDown && changecaract == false) {
                        pologlace = true
                        setTimeout(() => {
                        changecaract = true
                                    }, 400);
                                
                    
                    }
                    else if (keyA.isDown && changecaract == true) {
                        pologlace = false
                        setTimeout(() => {
                        changecaract = false
                                    }, 400);
                                

                    }

                    if (pologlace == true){
                        this.nuit.visible = true;
                            if (cursors.left.isDown) {
                            player.setVelocityX(-220);
                            player.anims.play("leftg", true);

                            // à droite
                        } else if (cursors.right.isDown) {
                            player.setVelocityX(220);
                            player.anims.play("rightg", true);
                        }
                        // immoobile
                        else {
                            player.setVelocityX(0);
                            player.anims.play("turng");
                        }
                        // en saut (important : blocked doown au lieu de tuoching down)
                        if (cursors.up.isDown && player.body.blocked.down) {
                            player.setVelocityY(-50);
                        }
                        if ((cursors.up.isDown && player.body.blocked.down)){
                                //si touche haut appuyée ET que le perso touche le sol
                                player.setVelocityY(-300); //alors vitesse verticale négative
                        }
                        if(repousseright == true){
                                player.setVelocityX(-100)
                                console.log("repousser !")
                            }

                        //changement etat des portes
                        

                        this.portelune.anims.play('portelunefermee', true)
                        this.portelune.setOffset(0,-1000);

                        this.portesoleil.anims.play('portesoleilfermee', true)
                        this.portesoleil.setOffset(0,0);

                        //comportement hotbox des projo
                        this.projo.setOffset(30,0);
                        this.obscur.setOffset(-5000,0);
                    }
                     
                    
                    
                    
                    
                    
                    
                        else if (pologlace == false){
                            this.nuit.visible = false;
                        // a gauche
                            if (cursors.left.isDown) {
                            player.setVelocityX(-230);
                            player.anims.play("left", true);

                            // à droite
                            } else if (cursors.right.isDown) {
                            player.setVelocityX(230);
                            player.anims.play("right", true);
                            }
                            // immoobile
                            else {
                            player.setVelocityX(0);
                            player.anims.play("turn");
                            }
                            //lorsdupremier saut, possibilité de double jump
                            if ((cursors.up.isDown && player.body.blocked.down)){
                                player.setVelocityY(-300);
                                doublejump = 0
                                setTimeout(() => {
                                    doublejump = 1
                                
                                    }, 300);
                            }
                            //Doublejump effectuer, un seul disponible après utilisation !
                            if ((cursors.up.isDown && doublejump == 1)){
                                        player.setVelocityY(-300);
                                        doublejump = 0
                            }
                            if ((player.body.blocked.down)){
                                        doublejump = 1
                            }


                            if (keyZ.isDown && lanceattack == true) {
                                attaque = true
                                lanceattack = false
                                setTimeout(() => {
                                    attaque = false
                                    this.zoneattack.y = -5000
                                    this.zoneattack.x = -5000
                                }, 200);
                                setTimeout(() => {
                                    lanceattack = true
                                }, 700);
                            }
                            if (attaque == true) {
                                this.zoneattack.y = player.y - 29
                                this.zoneattack.x = player.x - 29
                            }
                            if(repousseright == true){
                                player.setVelocityX(-100)
                                console.log("repousser !")
                            }







                            
                            //changement etat des portes
                            this.portesoleil.anims.play('portesoleilouverte', true)
                            this.portesoleil.setOffset(0,-1000);
                            

                            this.portelune.anims.play('porteluneouverte', true)
                            this.portelune.setOffset(0,0);
                            if(repousseright == true){
                                player.setVelocityX(-100)
                                console.log("repousser !")
                            }
                            //comportement hotbox des projo
                            this.projo.setOffset(-5000,0);
                            this.obscur.setOffset(0,0);
                            
                            
                        }
                    

                        player.body.setAllowGravity(true)
                    if (gameOver){return;}

                    



                            



                    
                }

                    

                    degats() {
                    

                        if (PV >= 1){
                            cursors.right.reset();
                            cursors.left.reset();
                            cursors.up.reset();
                            cursors.down.reset();
                            cursors.right.enabled = false;
                            cursors.left.enabled = false;
                            cursors.up.enabled = false;
                            cursors.down.enabled = false;
                            player.setVelocityY(-350)
                            repousseright = true
                            player.alpha = 0.5
                            this.serolReset = this.time.addEvent({
                            delay: 4000,
                            callback: ()=>{
                                player.alpha = 1;
                                PV = 0;
                            },
                            loop: false
                            })
                        this.serolReset = this.time.addEvent({
                            delay: 1700,
                            callback: ()=>{
                                repousseright = false
                                cursors.right.enabled = true;
                                cursors.left.enabled = true;
                                cursors.up.enabled = true;
                                cursors.down.enabled = true;
                            },
                            loop: false
                        })
                        console.log("aie")
                        }
                    
                        

                        if (PV == 0){
                            this.physics.pause();
                            player.setTint(0xff0000);
                            player.anims.play('turn');
                            gameOver = true;
                            console.log("aie2")
                        }
                        
                    
                    }

                    degatsennemi() {
                        this.followvirus.destroy()
                    

                    }

                    

                    collectpop(){
                    PV += 1; //augmente le score de 1
                    this.bitcoin.disableBody(true, true); // l’étoile disparaît
                    
                    }

                    escalade() {
                        if (pologlace == true){
                            player.body.setAllowGravity(false)
                            player.setVelocityX(0);
                            player.setVelocityY(0);
                            if (cursors.up.isDown) {
                            player.setVelocityY(-100);
                            }
                            if ((cursors.down.isDown)){
                                    //si touche haut appuyée ET que le perso touche le sol
                                    player.setVelocityY(100); //alors vitesse verticale négative
                            }

                        }

                    }

                }

















                    class Studio extends Phaser.Scene {


            constructor() {

                super("Studio")
            }




            preload() {
                    // chargement du personnage
                this.load.spritesheet("dude", "assets/Polo.png", {
                    frameWidth: 32,
                    frameHeight: 64
                });

                this.load.spritesheet("dude2", "assets/Pologlace.png", {
                    frameWidth: 32,
                    frameHeight: 64
                });

                this.load.spritesheet("dudeglace", "assets/Pologlace.png", {
                    frameWidth: 32,
                    frameHeight: 64
                });



                this.load.spritesheet("bitcoin", "assets/bitcoin.png", {
                    frameWidth: 32,
                    frameHeight: 32,
                });

                this.load.spritesheet("popcorn", "assets/popcorn.png", {
                    frameWidth: 32,
                    frameHeight: 48,
                });


                this.load.spritesheet("click", "assets/click.png", {
                    frameWidth: 32,
                    frameHeight: 32,
                });
                this.load.spritesheet("porte", "assets/portes.png", {
                    frameWidth: 64,
                    frameHeight: 64,
                });

                this.load.spritesheet("nacelle", "assets/nacellemobile.png", {
                    frameWidth: 96,
                    frameHeight: 64,
                });

                this.load.spritesheet("zoneattack", "assets/attack.png", {
                    frameWidth: 64,
                    frameHeight: 64,
                });

                this.load.spritesheet("ennemivol", "assets/ennemivol.png", {
                    frameWidth: 64,
                    frameHeight: 32,
                });

                this.load.spritesheet("ennemiterre", "assets/ennemiterre.png", {
                    frameWidth: 32,
                    frameHeight: 64,
                });

                this.load.spritesheet("miniobscur", "assets/miniobscur.png", {
                    frameWidth: 32,
                    frameHeight: 32,
                });

                this.load.spritesheet("shine", "assets/shine.png", {
                    frameWidth: 32,
                    frameHeight: 32,
                });

                this.load.spritesheet("safe", "assets/safe.png", {
                    frameWidth: 32,
                    frameHeight: 32,
                });

                this.load.spritesheet("transition", "assets/transition.png", {
                    frameWidth: 896,
                    frameHeight: 448,
                });

                this.load.image("vuedoki", "assets/vuedoki.png" );


                // chargement tuiles de jeu
                this.load.image("Phaser_Tileset", "assets/Placedoki.png");

                // chargement de la carte
                this.load.tilemapTiledJSON("carte", "assets/Studio.json");

                this.load.image("interfacefenetre", "assets/fenetre clean.png" );

                this.load.image("interfacenormal", "assets/interface full.png" );

                this.load.image("interfacedegats", "assets/interface degats.png" );
                this.load.spritesheet("virus", "assets/mobile.png", {
                    frameWidth: 32,
                    frameHeight: 32,
                });
                this.load.image('nuit', 'assets/nuit.png');
                this.load.spritesheet("projo", "assets/projo.png", {
                        frameWidth: 370,
                        frameHeight: 109,
                    });

                    this.load.spritesheet("projohorizon", "assets/projohorizon.png", {
                        frameWidth: 109,
                        frameHeight: 370,
                    });

                    this.load.spritesheet("obscur", "assets/obscur.png", {
                        frameWidth: 371,
                        frameHeight: 207,
                    });

                    this.load.spritesheet("chaise", "assets/chaise.png", {
                        frameWidth: 32,
                        frameHeight: 48,
                    });
                    
                

            }


            create() {
                    this.map = this.add.tilemap("carte");
                    // chargement de la carte du niveau
                    const carteDuNiveau = this.add.tilemap("carte");
                    // chargement du jeu de tuiles
                    const tileset = carteDuNiveau.addTilesetImage(
                    "Placedoki",
                    "Phaser_Tileset"
                    );

                    const fond = carteDuNiveau.createStaticLayer(
                    "fond",
                    tileset
                    );

                    // chargement du calque "calque_backgroung"
                    const deco = carteDuNiveau.createStaticLayer(
                    "deco",
                    tileset
                    );



                    // chargement du calque "calque_plateformes""
                    const sol = carteDuNiveau.createStaticLayer(
                    "sol",
                    tileset
                    );

                    // chargement du calque "calque_plateformes""
                    const grimpette = carteDuNiveau.createStaticLayer(
                    "grimpette",
                    tileset
                    );

                    this.popcorns = this.map.createLayer(
                        "popcornss",
                        this.tileset
                    );

                    this.obscurite = this.map.createLayer(
                        "obscurite",
                        this.tileset
                    );

                    this.shine = this.map.createLayer(
                        "shine",
                        this.tileset
                    );

                    this.projecteurs = this.map.createLayer(
                        "projecteurs",
                        this.tileset
                    );

                    this.projecteurshorizon = this.map.createLayer(
                        "projecteurshorizon",
                        this.tileset
                    );

                    this.switchplace = this.map.createLayer(
                        "safespot",
                        this.tileset
                    );



                    player = this.physics.add.sprite(4250,2945,"dude");
                    //player = this.physics.add.sprite(7120,700,"dude");




                    this.grppopcorns = this.physics.add.group({ immovable: true, allowGravity: false })
                    this.pop = this.map.getObjectLayer("popcornss");
                    this.pop.objects.forEach(coord => {
                        this.grppopcorns.create(coord.x, coord.y - 32, "popcorn");
                    });

                    this.grppobscur = this.physics.add.group({ immovable: true, allowGravity: false })
                    this.ombre = this.map.getObjectLayer("obscurite");
                    this.ombre.objects.forEach(coord => {
                        this.grppobscur.create(coord.x + 16, coord.y - 16, "miniobscur");
                    });

                    this.grpshine = this.physics.add.group({ immovable: true, allowGravity: false })
                    this.brillant = this.map.getObjectLayer("shine");
                    this.brillant.objects.forEach(coord => {
                        this.grpshine.create(coord.x + 16, coord.y - 16, "shine");
                    });

                    this.grpsafe = this.physics.add.group({ immovable: true, allowGravity: false })
                    this.safespot = this.map.getObjectLayer("safespot");
                    this.safespot.objects.forEach(coord => {
                        this.grpsafe.create(coord.x + 16, coord.y - 16, "safe");
                    });

                   
                    
                    

                    //affichage de l'interface
                    this.add.image(120,75, "interfacefenetre").setScrollFactor(0);
                    this.add.image(120,75, "interfacenormal").setScrollFactor(0);
                    //affiche un texte à l’écran, pour le score
                    
                    scoreText=this.add.text(175,100,'0',{fontSize:'32px',fill:'#000'}).setScrollFactor(0);

                    
                    var doublejump = 0
                    

                    // définition des objets solides avec lesquels le personnage va interagir
                    sol.setCollisionByProperty({ solide: true });
                    grimpette.setCollisionByProperty({ grimpe: true });

                    //nacceles
                    
                    
                   

                    // création du personnage de jeu et positionnement
                    
                    
                    keyA = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
                    keyZ = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Z);

                    // ajout du modèle de collision entre le personnage et les plates-formes et les ennemis et les piques
                    this.physics.add.collider(player, sol);
                    this.physics.add.collider(player, grimpette,this.escalade);
                    this.physics.add.overlap(player, this.grppobscur, this.degats, null, this);
                    this.physics.add.overlap(player, this.grpshine, this.degats, null, this);
                    this.physics.add.overlap(player, this.grpsafe, this.switch, null, this);
                    
                    
                    
                    
    
                    gameOver = false;



                    // ajout du modèle de collision entre le personnage et le monde
                    player.setCollideWorldBounds(true);

                    
                    

                    // animation du perso pour tourner à gauche
                    this.anims.create({
                    key: "left",
                    frames: this.anims.generateFrameNumbers("dude", { start: 0, end: 3 }),
                    frameRate: 10,
                    repeat: -1
                    });

                    // animation du perso lorsque le personnage n'avance pas
                    this.anims.create({
                    key: "turn",
                    frames: [{ key: "dude", frame: 4 }],
                    frameRate: 20
                    });

                    // animation du perso pour tourner à droite
                    this.anims.create({
                    key: "right",
                    frames: this.anims.generateFrameNumbers("dude", { start: 5, end: 8 }),
                    frameRate: 10,
                    repeat: -1
                    });


                    //animation des portes
                    this.anims.create({
                    key: "portesoleilouverte",
                    frames: this.anims.generateFrameNumbers("porte", { start: 1, end: 1 }),
                    frameRate: 10,
                    });
                    this.anims.create({
                    key: "portesoleilfermee",
                    frames: this.anims.generateFrameNumbers("porte", { start: 0, end: 0 }),
                    frameRate: 10,
                    });

                    this.anims.create({
                    key: "porteluneouverte",
                    frames: this.anims.generateFrameNumbers("porte", { start: 3}),
                    frameRate: 10,
                    
                    });
                    this.anims.create({
                    key: "portelunefermee",
                    frames: this.anims.generateFrameNumbers("porte", { start: 1, end: 1 }),
                    frameRate: 10,
                    });

                    this.anims.create({
                    key: "nacelleallumee",
                    frames: this.anims.generateFrameNumbers("nacelle", { start: 0, end: 5 }),
                    frameRate: 10,
                    repeat: -1
                    });
                    this.anims.create({
                    key: "popcorn",
                    frames: this.anims.generateFrameNumbers("popcorn", { start: 0, end: 7 }),
                    frameRate: 10,
                    repeat: -1
                    });

                    this.anims.create({
                    key: "chaise",
                    frames: this.anims.generateFrameNumbers("chaise", { start: 0, end: 9 }),
                    frameRate: 20,
                    repeat: -1
                    });

                    this.anims.create({
                    key: "transitionclap",
                    frames: this.anims.generateFrameNumbers("transition", { start: 0, end: 93 }),
                    frameRate: 30,
                    repeat: -1
                    });


                   

                    this.zoneattack = this.physics.add.sprite(100,1400,"zoneattack");
                    this.zoneattack.setCircle(48);
                    this.zoneattack.setImmovable();
                    this.zoneattack.body.setAllowGravity(false)
                    
                    

                    //nacelles
                    this.nacelle1 = this.physics.add.sprite(5660,2100,"nacelle");
                    this.nacelle1.setImmovable();
                    this.nacelle1.body.setAllowGravity(false);
                    this.physics.add.collider(player,this.nacelle1);
                    this.nacelle1.anims.play('nacelleallumee', true)
                    this.nacelle1.setSize(96, 32);
                    this.nacelle1.setOffset(0,32);

                    this.nacelle2 = this.physics.add.sprite(5900,390,"nacelle");
                    this.nacelle2.setImmovable();
                    this.nacelle2.body.setAllowGravity(false);
                    this.physics.add.collider(player,this.nacelle2);
                    this.nacelle2.anims.play('nacelleallumee', true)
                    this.nacelle2.setSize(96, 32);
                    this.nacelle2.setOffset(0,32);

                    this.nacelle3 = this.physics.add.sprite(7000,780,"nacelle");
                    this.nacelle3.setImmovable();
                    this.nacelle3.body.setAllowGravity(false);
                    this.physics.add.collider(player,this.nacelle3);
                    this.nacelle3.anims.play('nacelleallumee', true)
                    this.nacelle3.setSize(96, 32);
                    this.nacelle3.setOffset(0,32);



                    //popcorn
                    this.popcorn = this.physics.add.sprite(450,2976,"popcorn");
                    this.popcorn.body.setAllowGravity(false)
                    this.physics.add.overlap(player, this.grppopcorns, this.collectpop, null, this);
                    this.popcorn.anims.play('popcorn', true)
                    this.grppopcorns.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.anims.play('popcorn', true)
                    }, this)


                    //ennemivol
                    this.ennemivol = this.physics.add.sprite(4400,1280,"ennemivol");
                    this.physics.add.collider(this.ennemivol, sol);
                    this.ennemivol.body.setAllowGravity(false)
                    this.ennemivol.setImmovable(true);
                    this.physics.add.collider(player,this.ennemivol,this.degats,null,this);

                    this.hitbox = this.physics.add.sprite(4400,1280,"ennemivol");
                    this.hitbox.body.setAllowGravity(false)
                    this.hitbox.setImmovable(true);
                    this.hitbox.setSize(64, 300);
                    this.hitbox.setOffset(0,0);
                    this.physics.add.collider(player,this.hitbox,this.ennemitombe,null,this);



                    this.ennemivol2 = this.physics.add.sprite(5935,885,"ennemivol");
                    this.physics.add.collider(this.ennemivol2, sol);
                    this.ennemivol2.body.setAllowGravity(false)
                    this.ennemivol2.setImmovable(true);
                    this.physics.add.collider(player,this.ennemivol2,this.degats,null,this);

                    this.hitbox2 = this.physics.add.sprite(5935,885,"ennemivol");
                    this.hitbox2.body.setAllowGravity(false)
                    this.hitbox2.setImmovable(true);
                    this.hitbox2.setSize(64, 300);
                    this.hitbox2.setOffset(0,0);
                    this.physics.add.collider(player,this.hitbox2,this.ennemitombe2,null,this);


                    this.ennemivol3 = this.physics.add.sprite(5500,700,"ennemivol");
                    this.physics.add.collider(this.ennemivol3, sol);
                    this.ennemivol3.body.setAllowGravity(false)
                    this.ennemivol3.setImmovable(true);
                    this.physics.add.collider(player,this.ennemivol3,this.degats,null,this);

                    this.hitbox3 = this.physics.add.sprite(5500,700,"ennemivol");
                    this.hitbox3.body.setAllowGravity(false)
                    this.hitbox3.setImmovable(true);
                    this.hitbox3.setSize(64, 300);
                    this.hitbox3.setOffset(0,0);
                    this.physics.add.collider(player,this.hitbox3,this.ennemitombe3,null,this);




                    //ennemiterrestres
                    this.ennemiterre = this.physics.add.sprite(5500,2200,"ennemiterre");
                    this.physics.add.collider(this.ennemiterre, sol);
                    this.physics.add.collider(player,this.ennemiterre,this.degats,null,this);
                    this.physics.add.collider(this.zoneattack,this.ennemiterre, this.degatsennemi4,null,this);
                    this.ennemiterre.setImmovable(true);


                    this.ennemiterre2 = this.physics.add.sprite(6350,1100,"ennemiterre");
                    this.physics.add.collider(this.ennemiterre2, sol);
                    this.physics.add.collider(player,this.ennemiterre2,this.degats,null,this);
                    this.physics.add.collider( this.ennemiterre2,this.zoneattack,this.degatsennemi5,null,this);
                    this.ennemiterre2.setImmovable(true);
                    

                    //chaises
                    this.chaise1 = this.physics.add.sprite(5930,2000,"chaise");
                    this.physics.add.collider(this.chaise1, sol);
                    this.chaise1.setImmovable(true);
                    this.chaise1.setSize(32, 32);
                    this.chaise1.setOffset(0,16);
                    this.physics.add.collider(player,this.chaise1,this.bumper1,null,this);

                    this.chaise2 = this.physics.add.sprite(6000,1700,"chaise");
                    this.physics.add.collider(this.chaise2, sol);
                    this.chaise2.setImmovable(true);
                    this.chaise2.setSize(32, 32);
                    this.chaise2.setOffset(0,16);
                    this.physics.add.collider(player,this.chaise2,this.bumper2,null,this);

                    this.chaise3 = this.physics.add.sprite(5870,1400,"chaise");
                    this.physics.add.collider(this.chaise3, sol);
                    this.chaise3.setSize(32, 32);
                    this.chaise3.setOffset(0,16);
                    this.chaise3.setImmovable(true);
                    this.physics.add.collider(player,this.chaise3,this.bumper3,null,this);

                    this.chaise4 = this.physics.add.sprite(5260,1263,"chaise");
                    this.physics.add.collider(this.chaise4, sol);
                    this.chaise4.setSize(32, 32);
                    this.chaise4.setOffset(0,16);
                    this.chaise4.setImmovable(true);
                    this.physics.add.collider(player,this.chaise4,this.bumper4,null,this);

                    this.chaise5 = this.physics.add.sprite(5900,700,"chaise");
                    this.physics.add.collider(this.chaise5, sol);
                    this.chaise5.setSize(32, 32);
                    this.chaise5.setOffset(0,16);
                    this.chaise5.setImmovable(true);
                    this.physics.add.collider(player,this.chaise5,this.bumper5,null,this);

                    this.chaise6 = this.physics.add.sprite(5650,500,"chaise");
                    this.physics.add.collider(this.chaise6, sol);
                    this.chaise6.setSize(32, 32);
                    this.chaise6.setOffset(0,16);
                    this.chaise6.setImmovable(true);
                    this.physics.add.collider(player,this.chaise6,this.bumper6,null,this);

                    this.chaise7 = this.physics.add.sprite(7120,700,"chaise");
                    this.physics.add.collider(this.chaise7, sol);
                    this.chaise7.setImmovable(true);
                    this.chaise7.setSize(32, 32);
                    this.chaise7.setOffset(0,16);
                    this.physics.add.collider(player,this.chaise7,this.bumper7,null,this);


                    this.anims.create({
                    key: "leftg",
                    frames: this.anims.generateFrameNumbers("dude", { start: 9, end:12 }),
                    frameRate: 10,
                    repeat: -1
                    });

                    // animation du perso lorsque le personnage n'avance pas
                    this.anims.create({
                    key: "turng",
                    frames: [{ key: "dude", frame: 13 }],
                    frameRate: 20
                    });

                    // animation du perso pour tourner à droite
                    this.anims.create({
                    key: "rightg",
                    frames: this.anims.generateFrameNumbers("dude", { start: 15, end: 18 }),
                    frameRate: 10,
                    repeat: -1
                    });

                    





                    // création d'un écouteur sur le cursors
                    cursors = this.input.keyboard.createCursorKeys();

                    // redimentionnement du monde avec les dimensions calculées via tiled
                    this.physics.world.setBounds(0, 0, 9999, 3264);
                    //  ajout du champs de la caméra de taille identique à celle du monde
                    this.cameras.main.setBounds(0, 0, 9999, 3264);
                    // ancrage de la caméra sur le joueur
                    this.cameras.main.startFollow(player); 


                    this.anims.create({
                    key: 'virusactif',
                    frames: this.anims.generateFrameNumbers('virus', { start: 0, end: 1 }),
                    frameRate: 10,
                    repeat: -1
                    });

                    var startPoint = new Phaser.Math.Vector2(900, 630);
                    var controlPoint1 = new Phaser.Math.Vector2(1000, 630);
                    var controlPoint2 = new Phaser.Math.Vector2(1250, 630);
                    var endPoint = new Phaser.Math.Vector2(1600, 630);

                    var curve = new Phaser.Curves.CubicBezier(startPoint, controlPoint1, controlPoint2, endPoint);

                    var graphics = this.add.graphics();



                    this.followvirus = this.add.follower(curve, 3700, 2350, 'virus').setInteractive();
                    this.physics.add.existing(this.followvirus);
                    this.followvirus.body.setAllowGravity(false)
                    this.followvirus.anims.play('virusactif', true)
                    var shape = new Phaser.Geom.Circle(96,96,96);
                    this.followvirus.setInteractive(shape, Phaser.Geom.Circle.Contains);
                    this.followvirus.setSize(32, 32);
                    this.physics.add.collider(player, this.followvirus,this.degats,null,this);
                    
                    
                    
                    //Action de la zone d'attaque
                    this.physics.add.collider(this.zoneattack, this.followvirus,this.degatsennemi,null,this);
                    this.physics.add.collider(this.zoneattack, this.ennemivol,this.degatsennemi2,null,this);
                    this.physics.add.collider(this.zoneattack, this.ennemivol2,this.degatsennemi3,null,this);
                    this.physics.add.collider(this.zoneattack, this.ennemivol3,this.degatsennemi7,null,this);
                    
                    

                    this.followvirus.startFollow({
                        duration: 5000,
                        yoyo: true,
                        ease: 'Sine.easeInOut',
                        repeat : -1
                    });

                    this.nuit = this.add.sprite(550, 475, 'nuit').setScrollFactor(0);
                    this.nuit.alpha = 0.8;
                    this.nuit.visible = false;




                    


                    //projecteurs
                    this.projo1 = this.physics.add.sprite(6270,770,"projo");
                    this.projo1.setImmovable();
                    this.projo1.body.setAllowGravity(false);
                    this.projo1.setSize(50, 370);
                    this.projo1.setOffset(30,0);
                    this.projo1.setScale(0.4)
                    this.physics.add.collider(player, this.projo1,this.degats,null,this);

                    this.projo2 = this.physics.add.sprite(7800,460,"projo");
                    this.projo2.setImmovable();
                    this.projo2.body.setAllowGravity(false);
                    this.projo2.setSize(50, 370);
                    this.projo2.setOffset(30,0);
                    this.projo2.setScale(0.8)
                    this.physics.add.collider(player, this.projo2,this.degats,null,this);

                    this.timedEventprojo = new Phaser.Time.TimerEvent({ delay: 1250, callback: this.projoeteint, callbackScope: this, loop: true});
                    this.time.addEvent(this.timedEventprojo);

                    this.timedEventprojo2 = new Phaser.Time.TimerEvent({ delay: 2500, callback: this.projoallumee, callbackScope: this, loop: true});
                    this.time.addEvent(this.timedEventprojo2);

                   
                    //vue trouble pour Doki
                    this.vuedoki = this.add.sprite(448, 225, 'vuedoki').setScrollFactor(0);
                    this.vuedoki.alpha = 0.8;
                    this.vuedoki.visible = false;


                    //ecran de chargement et de transition
                    //this.transition = this.add.sprite(448, 225, 'transition').setScrollFactor(0);
                    //this.transition.anims.play('transitionclap', true)


                    this.grpprojo = this.physics.add.group({ immovable: true, allowGravity: false })
                    this.lumiere = this.map.getObjectLayer("projecteurs");
                    this.lumiere.objects.forEach(coord => {
                        this.grpprojo.create(coord.x + 32, coord.y + 79, "projo");
                    });
                    this.grpprojo.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setSize(50, 370);
                        child.setOffset(32,0);
                        child.setScale(0.8)
                        }, this)


                    this.grpprojohorizon = this.physics.add.group({ immovable: true, allowGravity: false })
                    this.lumierehorizon = this.map.getObjectLayer("projecteurshorizon");
                    this.lumierehorizon.objects.forEach(coord => {
                        this.grpprojohorizon.create(coord.x - 64, coord.y, "projohorizon");
                    });
                    this.grpprojohorizon.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setSize(370, 50);
                        child.setOffset(32,64);
                        child.setScale(0.7)
                        }, this)

                    this.physics.add.overlap(player, this.grpprojo, this.degats, null, this);
                    this.physics.add.overlap(player, this.grpprojohorizon, this.degats, null, this);

                    
                    this.timedEvent = new Phaser.Time.TimerEvent({ delay: 30000, callback: this.degatschrono, callbackScope: this, loop: true});
                    this.time.addEvent(this.timedEvent);
                

                    
                   
       

            }

            update() {

                    
                    
                    //console.log(safe)
                    console.log(EnnemiUnFollow)
                    scoreText.setText(PV)

                    


                    if(this.nacelle1.y >= 2255){
                        this.nacelle1.setVelocityY(-75);
                    }
                    else if (this.nacelle1.y <= 2100){
                        this.nacelle1.setVelocityY(75);
                    }


                    if(this.nacelle2.x >= 5900){
                        this.nacelle2.setVelocityX(-75);
                    }
                    else if (this.nacelle2.x <= 5700){
                        this.nacelle2.setVelocityX(75);
                    }

                    if(this.nacelle3.x >= 7000){
                        this.nacelle3.setVelocityX(-75);
                    }
                    else if (this.nacelle3.x <= 6900){
                        this.nacelle3.setVelocityX(75);
                    }







                    if(this.projo1.x >= 6270){
                        this.projo1.setVelocityX(-75);
                    }
                    else if (this.projo1.x <= 6100){
                        this.projo1.setVelocityX(75);
                    }


                    if(this.ennemiterre.x >= 5450 && ennemipattern1 == true){
                        this.ennemiterre.setVelocityX(-75);
                    }
                    else if (this.ennemiterre.x <= 5400){
                        this.ennemiterre.setVelocityX(75);
                    }

                    if(this.ennemiterre2.x >= 6350 && ennemipattern2 == true){
                        this.ennemiterre2.setVelocityX(-75);
                    }
                    else if (this.ennemiterre2.x <= 6200){
                        this.ennemiterre2.setVelocityX(75);
                    }





                if (keyA.isDown && changecaract == false) {
                    if(safe == true){
                        pologlace = true
                    }
                    
                    setTimeout(() => {
                    changecaract = true
                                }, 170);
                            
                
                }
                else if (keyA.isDown && changecaract == true) {
                    if(safe == true){
                        pologlace = false
                    }
                    this.time.addEvent(this.timedEvent);
                    setTimeout(() => {
                    changecaract = false
                                }, 170);
                            

                }

                if (pologlace == true){
                    player.setGravity(0, -300)
                    this.nuit.visible = true;
                    this.vuedoki.visible = true;
                    this.grpprojo.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(32,0);
                    }, this)

                    this.grpprojohorizon.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(0,32);
                    }, this)

                    this.grppobscur.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(5000,0);
                    }, this)

                    this.grpshine.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(0,0);
                    }, this)

                        if (cursors.left.isDown) {
                        player.setVelocityX(-220);
                        player.anims.play("leftg", true);

                        // à droite
                    } else if (cursors.right.isDown) {
                        player.setVelocityX(220);
                        player.anims.play("rightg", true);
                    }
                    // immoobile
                    else {
                        player.setVelocityX(0);
                        player.anims.play("turng");
                    }
                    // en saut (important : blocked doown au lieu de tuoching down)
                    if (cursors.up.isDown && player.body.blocked.down) {
                        player.setVelocityY(-50);
                    }
                    if ((cursors.up.isDown && player.body.blocked.down)){
                            //si touche haut appuyée ET que le perso touche le sol
                            player.setVelocityY(-228); //alors vitesse verticale négative
                    }
                    
                            if (keyZ.isDown && lanceattack == true) {
                            attaque = true
                            lanceattack = false
                            setTimeout(() => {
                                attaque = false
                                this.zoneattack.y = -5000
                                this.zoneattack.x = -5000
                            }, 200);
                            setTimeout(() => {
                                lanceattack = true
                            }, 700);
                        }
                        if (attaque == true) {
                            this.zoneattack.y = player.y - 29
                            this.zoneattack.x = player.x - 29
                        }

                    //changement etat des portes
                    

                    
                    //this.projo1.setOffset(30,0);
                    //this.projo2.setOffset(30,0);
                    
                }
                    else if (pologlace == false){

                        player.setGravity(0, 0)
                        this.grpprojo.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(5000,0);
                        }, this)

                        this.grpprojohorizon.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(5000,0);
                        }, this)

                        this.nuit.visible = false;
                        this.vuedoki.visible = false;
                        this.grppobscur.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(0,0);
                        }, this)

                        this.grpshine.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(5000,0);
                        }, this)


                    // a gauche
                        if (cursors.left.isDown) {
                        player.setVelocityX(-400);
                        player.anims.play("left", true);

                        // à droite
                        } else if (cursors.right.isDown) {
                        player.setVelocityX(400);
                        player.anims.play("right", true);
                        }
                        // immoobile
                        else {
                        player.setVelocityX(0);
                        player.anims.play("turn");
                        }
                        //lorsdupremier saut, possibilité de double jump
                        if ((cursors.up.isDown && player.body.blocked.down)){
                            player.setVelocityY(-300);
                            doublejump = 0
                            setTimeout(() => {
                                doublejump = 1
                               
                                }, 300);
                        }
                        //Doublejump effectuer, un seul disponible après utilisation !
                        if ((cursors.up.isDown && doublejump == 1)){
                                    player.setVelocityY(-300);
                                    doublejump = 0
                        }
                        if ((player.body.blocked.down)){
                                    doublejump = 1
                        }


                        if (keyZ.isDown && lanceattack == true) {
                            attaque = true
                            lanceattack = false
                            setTimeout(() => {
                                attaque = false
                                this.zoneattack.y = -5000
                                this.zoneattack.x = -5000
                            }, 200);
                            setTimeout(() => {
                                lanceattack = true
                            }, 700);
                        }
                        if (attaque == true) {
                            this.zoneattack.y = player.y - 29
                            this.zoneattack.x = player.x - 29
                        }



                        





                        
                        //changement etat des portes
                       
                        //this.projo1.setOffset(-5000,0);
                        //this.projo2.setOffset(-5000,0);
                        
                        if(repousseright == true){
                            
                            console.log("repousser !")
                        }
                        
                        
                    }
                

                    player.body.setAllowGravity(true)
                if (gameOver){return;}

                



                        



                
            }

                

                degats() {
                

                    if (PV >= 1 && tempsdegats == false ){
                        PV = 0
                        tempsdegats = true
                        cursors.right.reset();
                        cursors.left.reset();
                        cursors.up.reset();
                        cursors.down.reset();
                        repousseright = true
                        player.alpha = 0.5
                        player.setVelocityY(-60)
                        player.setVelocityX(-300)
                        this.serolReset = this.time.addEvent({
                        delay: 4000,
                        callback: ()=>{
                            tempsdegats = false
                            player.alpha = 1;
                            ;
                        },
                        loop: false
                        })
                    this.serolReset = this.time.addEvent({
                        delay: 500,
                        callback: ()=>{
                            repousseright = false
                            cursors.right.enabled = true;
                            cursors.left.enabled = true;
                            cursors.up.enabled = true;
                            cursors.down.enabled = true;
                        },
                        loop: false
                    })
                    console.log("aie")
                    }
                   
                    

                    if (PV == 0 && tempsdegats == false){
                        this.physics.pause();
                        player.setTint(0xff0000);
                        player.anims.play('turn');
                        gameOver = true;
                        console.log("aie2")
                    }
                    
                
                }



                degatschrono() {
                

                if (PV >= 1 && pologlace == false){
                    cursors.right.reset();
                    cursors.left.reset();
                    cursors.up.reset();
                    cursors.down.reset();
                    cursors.right.enabled = false;
                    cursors.left.enabled = false;
                    cursors.up.enabled = false;
                    cursors.down.enabled = false;
                    player.setVelocityY(0)
                    player.setVelocityX(0)
                    repousseright = true
                    player.alpha = 0.5
                    this.serolReset = this.time.addEvent({
                    delay: 4000,
                    callback: ()=>{
                        player.alpha = 1;
                        PV = 0;
                    },
                    loop: false
                    })
                this.serolReset = this.time.addEvent({
                    delay: 1700,
                    callback: ()=>{
                        repousseright = false
                        cursors.right.enabled = true;
                        cursors.left.enabled = true;
                        cursors.up.enabled = true;
                        cursors.down.enabled = true;
                    },
                    loop: false
                })
                console.log("aie")
                }
               
                

                if (PV == 0 && pologlace == false){
                    this.physics.pause();
                    player.setTint(0xff0000);
                    player.anims.play('turn');
                    gameOver = true;
                    console.log("aie2")
                }
                
            
            }


                projoeteint() {
                this.projo2.setOffset(0,5000);

                }

                projoallumee() {
                this.projo2.setOffset(32,0);

                }

                degatsennemi() {
                    this.followvirus.destroy()
                }
                degatsennemi2() {
                    this.ennemivol.destroy()
                }
                degatsennemi3() {
                    this.ennemivol2.destroy()
                }


                degatsennemi4() {
                    this.ennemipattern1 = false
                    this.ennemiterre.destroy()
                }

                degatsennemi5() {
                    this.ennemipattern2 = false
                    this.ennemiterre2.destroy()
                }

                

                degatsennemi7() {
                    this.ennemivol3.destroy()
                }


                EnnemiUnAggro() {
                this.EnnemiUnFollow = true;
                this.SpriteHitBoxUn.destroy()
                }


                ennemitombe() {
                    this.hitbox.destroy()
                    this.ennemivol.body.setAllowGravity(true)
            
                }

                ennemitombe2() {
                    this.hitbox2.destroy()
                    this.ennemivol2.body.setAllowGravity(true)
            
                }

                ennemitombe2() {
                    this.hitbox2.destroy()
                    this.ennemivol2.body.setAllowGravity(true)
            
                }

                ennemitombe3() {
                    this.hitbox3.destroy()
                    this.ennemivol3.body.setAllowGravity(true)
            
                }

                switch() {
                    safe = true
                    setTimeout(() => {
                    safe = false
                                }, 90);
                    
            
                }


                collectpop(player, pop){
                PV += 1; //augmente le score de 1
                this.popcorn.destroy() // l’étoile disparaît
                pop.destroy()
                }


                bumper1() {
                    this.chaise1.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-600)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-400)
                    }
                    
                
            
                }

                bumper2() {
                    this.chaise2.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-600)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-400)
                    }
                    
                
            
                }

                bumper3() {
                    this.chaise3.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-475)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-350)
                    }
                    
                
            
                }

                bumper4() {
                    this.chaise4.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-550)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-380)
                    }
                   
                
            
                }

                bumper5() {
                    this.chaise5.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-550)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-380)
                    }
                   
                
            
                }

                bumper6() {
                    this.chaise6.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-550)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-380)
                    }
                   
                
            
                }

                bumper7() {
                    this.chaise7.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-395)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-340)
                    }
                   
                
            
                }


                escalade() {
                    if (pologlace == true){
                        player.body.setAllowGravity(false)
                        player.setVelocityX(0);
                        player.setVelocityY(0);
                        if (cursors.up.isDown) {
                        player.setVelocityY(-100);
                        }
                        if ((cursors.down.isDown)){
                                //si touche haut appuyée ET que le perso touche le sol
                                player.setVelocityY(100); //alors vitesse verticale négative
                        }

                    }
            
                }

            }

























                        class Manoir extends Phaser.Scene {


            constructor() {

                super("Manoir")
            }




            preload() {
                    // chargement du personnage
                this.load.spritesheet("dude", "assets/Polo.png", {
                    frameWidth: 32,
                    frameHeight: 64
                });

                this.load.spritesheet("dude2", "assets/Pologlace.png", {
                    frameWidth: 32,
                    frameHeight: 64
                });

                this.load.spritesheet("dudeglace", "assets/Pologlace.png", {
                    frameWidth: 32,
                    frameHeight: 64
                });



                this.load.spritesheet("bitcoin", "assets/bitcoin.png", {
                    frameWidth: 32,
                    frameHeight: 32,
                });

                this.load.spritesheet("popcorn", "assets/popcorn.png", {
                    frameWidth: 32,
                    frameHeight: 48,
                });


                this.load.spritesheet("click", "assets/click.png", {
                    frameWidth: 32,
                    frameHeight: 32,
                });
                this.load.spritesheet("porte", "assets/portes.png", {
                    frameWidth: 64,
                    frameHeight: 64,
                });

                this.load.spritesheet("nacelle", "assets/nacellemobile.png", {
                    frameWidth: 96,
                    frameHeight: 64,
                });

                this.load.spritesheet("zoneattack", "assets/attack.png", {
                    frameWidth: 64,
                    frameHeight: 64,
                });

                this.load.spritesheet("ennemivol", "assets/ennemivol.png", {
                    frameWidth: 64,
                    frameHeight: 32,
                });

                this.load.spritesheet("ennemiterre", "assets/ennemiterre.png", {
                    frameWidth: 32,
                    frameHeight: 64,
                });

                this.load.spritesheet("miniobscur", "assets/miniobscur.png", {
                    frameWidth: 32,
                    frameHeight: 32,
                });

                this.load.spritesheet("shine", "assets/shine.png", {
                    frameWidth: 32,
                    frameHeight: 32,
                });

                this.load.spritesheet("safe", "assets/safe.png", {
                    frameWidth: 32,
                    frameHeight: 32,
                });

                this.load.image("vuedoki", "assets/vuedoki.png" );


                // chargement tuiles de jeu
                this.load.image("Phaser_Tileset", "assets/Placedoki.png");

                // chargement de la carte
                this.load.tilemapTiledJSON("carte", "assets/Manoir.json");

                this.load.image("interfacefenetre", "assets/fenetre clean.png" );

                this.load.image("interfacenormal", "assets/interface full.png" );

                this.load.image("interfacedegats", "assets/interface degats.png" );
                this.load.spritesheet("virus", "assets/mobile.png", {
                    frameWidth: 32,
                    frameHeight: 32,
                });
                this.load.image('nuit', 'assets/nuit.png');
                this.load.spritesheet("projo", "assets/projo.png", {
                        frameWidth: 370,
                        frameHeight: 109,
                    });

                    this.load.spritesheet("projohorizon", "assets/projohorizon.png", {
                        frameWidth: 109,
                        frameHeight: 370,
                    });

                    this.load.spritesheet("transition", "assets/transition.png", {
                        frameWidth: 896,
                        frameHeight: 448,
                    });

                    this.load.spritesheet("obscur", "assets/obscur.png", {
                        frameWidth: 371,
                        frameHeight: 207,
                    });

                    this.load.spritesheet("chaise", "assets/chaise.png", {
                        frameWidth: 32,
                        frameHeight: 48,
                    });

                    this.load.spritesheet("fantom", "assets/fantom.png", {
                        frameWidth: 346,
                        frameHeight: 511,
                    });
                    
                    
                

            }


            create() {
                    this.map = this.add.tilemap("carte");
                    // chargement de la carte du niveau
                    const carteDuNiveau = this.add.tilemap("carte");
                    // chargement du jeu de tuiles
                    const tileset = carteDuNiveau.addTilesetImage(
                    "Placedoki",
                    "Phaser_Tileset"
                    );

                    const fond = carteDuNiveau.createStaticLayer(
                    "fond",
                    tileset
                    );

                    // chargement du calque "calque_backgroung"
                    const deco = carteDuNiveau.createStaticLayer(
                    "deco",
                    tileset
                    );



                    // chargement du calque "calque_plateformes""
                    const sol = carteDuNiveau.createStaticLayer(
                    "sol",
                    tileset
                    );

                    // chargement du calque "calque_plateformes""
                    const grimpette = carteDuNiveau.createStaticLayer(
                    "grimpette",
                    tileset
                    );

                    this.popcorns = this.map.createLayer(
                        "popcornss",
                        this.tileset
                    );

                    this.obscurite = this.map.createLayer(
                        "obscurite",
                        this.tileset
                    );

                    this.shine = this.map.createLayer(
                        "shine",
                        this.tileset
                    );

                    this.projecteurs = this.map.createLayer(
                        "projecteurs",
                        this.tileset
                    );

                    this.projecteurshorizon = this.map.createLayer(
                        "projecteurshorizon",
                        this.tileset
                    );

                    this.switchplace = this.map.createLayer(
                        "safespot",
                        this.tileset
                    );



                    player = this.physics.add.sprite(1000,3880,"dude");
                    //player = this.physics.add.sprite(7000,1790,"dude");




                    this.grppopcorns = this.physics.add.group({ immovable: true, allowGravity: false })
                    this.pop = this.map.getObjectLayer("popcornss");
                    this.pop.objects.forEach(coord => {
                        this.grppopcorns.create(coord.x, coord.y - 32, "popcorn");
                    });

                    this.grppobscur = this.physics.add.group({ immovable: true, allowGravity: false })
                    this.ombre = this.map.getObjectLayer("obscurite");
                    this.ombre.objects.forEach(coord => {
                        this.grppobscur.create(coord.x + 16, coord.y - 16, "miniobscur");
                    });

                    this.grpshine = this.physics.add.group({ immovable: true, allowGravity: false })
                    this.brillant = this.map.getObjectLayer("shine");
                    this.brillant.objects.forEach(coord => {
                        this.grpshine.create(coord.x + 16, coord.y - 16, "shine");
                    });

                    this.grpsafe = this.physics.add.group({ immovable: true, allowGravity: false })
                    this.safespot = this.map.getObjectLayer("safespot");
                    this.safespot.objects.forEach(coord => {
                        this.grpsafe.create(coord.x + 16, coord.y - 16, "safe");
                    });

                
                    
                    

                    //affichage de l'interface
                    this.add.image(120,75, "interfacefenetre").setScrollFactor(0);
                    this.add.image(120,75, "interfacenormal").setScrollFactor(0);
                    //affiche un texte à l’écran, pour le score
                    
                    scoreText=this.add.text(175,100,'0',{fontSize:'32px',fill:'#000'}).setScrollFactor(0);

                    
                    var doublejump = 0
                    

                    // définition des objets solides avec lesquels le personnage va interagir
                    sol.setCollisionByProperty({ solide: true });
                    grimpette.setCollisionByProperty({ grimpe: true });

                    //nacceles
                    
                    
                

                    // création du personnage de jeu et positionnement
                    
                    
                    keyA = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
                    keyZ = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Z);

                    // ajout du modèle de collision entre le personnage et les plates-formes et les ennemis et les piques
                    this.physics.add.collider(player, sol);
                    this.physics.add.collider(player, grimpette,this.escalade);
                    this.physics.add.overlap(player, this.grppobscur, this.degats, null, this);
                    this.physics.add.overlap(player, this.grpshine, this.degats, null, this);
                    this.physics.add.overlap(player, this.grpsafe, this.switch, null, this);
                    
                    
                    
                    

                    gameOver = false;



                    // ajout du modèle de collision entre le personnage et le monde
                    player.setCollideWorldBounds(true);

                    
                    

                    // animation du perso pour tourner à gauche
                    this.anims.create({
                    key: "left",
                    frames: this.anims.generateFrameNumbers("dude", { start: 0, end: 3 }),
                    frameRate: 10,
                    repeat: -1
                    });

                    // animation du perso lorsque le personnage n'avance pas
                    this.anims.create({
                    key: "turn",
                    frames: [{ key: "dude", frame: 4 }],
                    frameRate: 20
                    });

                    // animation du perso pour tourner à droite
                    this.anims.create({
                    key: "right",
                    frames: this.anims.generateFrameNumbers("dude", { start: 5, end: 8 }),
                    frameRate: 10,
                    repeat: -1
                    });


                    //animation des portes
                    this.anims.create({
                    key: "portesoleilouverte",
                    frames: this.anims.generateFrameNumbers("porte", { start: 1, end: 1 }),
                    frameRate: 10,
                    });
                    this.anims.create({
                    key: "portesoleilfermee",
                    frames: this.anims.generateFrameNumbers("porte", { start: 0, end: 0 }),
                    frameRate: 10,
                    });

                    this.anims.create({
                    key: "porteluneouverte",
                    frames: this.anims.generateFrameNumbers("porte", { start: 3}),
                    frameRate: 10,
                    
                    });
                    this.anims.create({
                    key: "portelunefermee",
                    frames: this.anims.generateFrameNumbers("porte", { start: 1, end: 1 }),
                    frameRate: 10,
                    });

                    this.anims.create({
                    key: "nacelleallumee",
                    frames: this.anims.generateFrameNumbers("nacelle", { start: 0, end: 5 }),
                    frameRate: 10,
                    repeat: -1
                    });
                    this.anims.create({
                    key: "popcorn",
                    frames: this.anims.generateFrameNumbers("popcorn", { start: 0, end: 7 }),
                    frameRate: 10,
                    repeat: -1
                    });

                    this.anims.create({
                    key: "chaise",
                    frames: this.anims.generateFrameNumbers("chaise", { start: 0, end: 9 }),
                    frameRate: 20,
                    repeat: -1
                    });


                    this.zoneattack = this.physics.add.sprite(100,1400,"zoneattack");
                    this.zoneattack.setCircle(48);
                    this.zoneattack.setImmovable();
                    this.zoneattack.body.setAllowGravity(false)
                    
                    //popcorns
                    
                    this.grppopcorns.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.anims.play('popcorn', true)
                    }, this)
                    this.physics.add.overlap(player, this.grppopcorns, this.collectpop, null, this);

                    //nacelles
                    //this.nacelle1 = this.physics.add.sprite(5660,2100,"nacelle");
                    //this.nacelle1.setImmovable();
                    //this.nacelle1.body.setAllowGravity(false);
                    //this.physics.add.collider(player,this.nacelle1);
                    //this.nacelle1.anims.play('nacelleallumee', true)
                    //this.nacelle1.setSize(96, 32);
                    //this.nacelle1.setOffset(0,32);

                    



                    


                    //ennemivol
                    this.ennemivol = this.physics.add.sprite(2150,2710,"ennemivol");
                    this.physics.add.collider(this.ennemivol, sol);
                    this.ennemivol.body.setAllowGravity(false)
                    this.ennemivol.setImmovable(true);
                    this.physics.add.collider(player,this.ennemivol,this.degats,null,this);

                    this.hitbox = this.physics.add.sprite(2150,2710,"ennemivol");
                    this.hitbox.body.setAllowGravity(false)
                    this.hitbox.setImmovable(true);
                    this.hitbox.setSize(64, 300);
                    this.hitbox.setOffset(0,0);
                    this.physics.add.collider(player,this.hitbox,this.ennemitombe,null,this);



                    this.ennemivol2 = this.physics.add.sprite(5935,885,"ennemivol");
                    this.physics.add.collider(this.ennemivol2, sol);
                    this.ennemivol2.body.setAllowGravity(false)
                    this.ennemivol2.setImmovable(true);
                    this.physics.add.collider(player,this.ennemivol2,this.degats,null,this);

                    this.hitbox2 = this.physics.add.sprite(5935,885,"ennemivol");
                    this.hitbox2.body.setAllowGravity(false)
                    this.hitbox2.setImmovable(true);
                    this.hitbox2.setSize(64, 300);
                    this.hitbox2.setOffset(0,0);
                    this.physics.add.collider(player,this.hitbox2,this.ennemitombe2,null,this);


                    this.ennemivol3 = this.physics.add.sprite(4790,2050,"ennemivol");
                    this.physics.add.collider(this.ennemivol3, sol);
                    this.ennemivol3.body.setAllowGravity(false)
                    this.ennemivol3.setImmovable(true);
                    this.physics.add.collider(this.zoneattack,this.ennemivol3,this.degatsennemi7,null,this);
                    this.physics.add.collider(player,this.ennemivol3,this.degats,null,this);

                    this.hitbox3 = this.physics.add.sprite(4790,2050,"ennemivol");
                    this.hitbox3.body.setAllowGravity(false)
                    this.hitbox3.setImmovable(true);
                    this.hitbox3.setSize(64, 300);
                    this.hitbox3.setOffset(0,0);
                    this.physics.add.collider(player,this.hitbox3,this.ennemitombe3,null,this);


                    this.ennemivol4 = this.physics.add.sprite(1460,3000,"ennemivol");
                    this.physics.add.collider(this.zoneattack,this.ennemivol4,this.degatsennemi10,null,this);
                    this.physics.add.collider(this.ennemivol4, sol);
                    this.ennemivol4.body.setAllowGravity(false)
                    this.ennemivol4.setImmovable(true);
                    this.physics.add.collider(player,this.ennemivol4,this.degats,null,this);

                    this.hitbox4 = this.physics.add.sprite(1460,3000,"ennemivol");
                    this.hitbox4.body.setAllowGravity(false)
                    this.hitbox4.setImmovable(true);
                    this.hitbox4.setSize(64, 300);
                    this.hitbox4.setOffset(0,0);
                    this.physics.add.collider(player,this.hitbox4,this.ennemitombe4,null,this);



                    this.ennemivol5 = this.physics.add.sprite(1600,1950,"ennemivol");
                    this.physics.add.collider(this.zoneattack,this.ennemivol5,this.degatsennemi11,null,this);
                    this.physics.add.collider(this.ennemivol5, sol);
                    this.ennemivol5.body.setAllowGravity(false)
                    this.ennemivol5.setImmovable(true);
                    this.physics.add.collider(player,this.ennemivol5,this.degats,null,this);

                    this.hitbox5 = this.physics.add.sprite(1600,1950,"ennemivol");
                    this.hitbox5.body.setAllowGravity(false)
                    this.hitbox5.setImmovable(true);
                    this.hitbox5.setSize(64, 300);
                    this.hitbox5.setOffset(0,0);
                    this.physics.add.collider(player,this.hitbox5,this.ennemitombe5,null,this);




                    //ennemiterrestres
                    this.ennemiterre = this.physics.add.sprite(5500,2200,"ennemiterre");
                    this.physics.add.collider(this.ennemiterre, sol);
                    this.physics.add.collider(player,this.ennemiterre,this.degats,null,this);
                    this.physics.add.collider( this.ennemiterre,this.zoneattack,this.degatsennemi4,null,this);
                    this.ennemiterre.setImmovable(true);


                    this.ennemiterre2 = this.physics.add.sprite(7100,1700,"ennemiterre");
                    this.physics.add.collider(this.ennemiterre2, sol);
                    this.physics.add.collider(player,this.ennemiterre2,this.degats,null,this);
                    this.physics.add.collider( this.ennemiterre2,this.zoneattack,this.degatsennemi5,null,this);
                    this.ennemiterre2.setImmovable(true);
                    

                    //chaises
                    this.chaise1 = this.physics.add.sprite(930,2620,"chaise");
                    this.physics.add.collider(this.chaise1, sol);
                    this.chaise1.setImmovable(true);
                    this.chaise1.setSize(32, 32);
                    this.chaise1.setOffset(0,16);
                    this.physics.add.collider(player,this.chaise1,this.bumper1,null,this);

                    this.chaise2 = this.physics.add.sprite(3600,2620,"chaise");
                    this.physics.add.collider(this.chaise2, sol);
                    this.chaise2.setImmovable(true);
                    this.chaise2.setSize(32, 32);
                    this.chaise2.setOffset(0,16);
                    this.physics.add.collider(player,this.chaise2,this.bumper2,null,this);

                    this.chaise3 = this.physics.add.sprite(3440,2620,"chaise");
                    this.physics.add.collider(this.chaise3, sol);
                    this.chaise3.setImmovable(true);
                    this.chaise3.setSize(32, 32);
                    this.chaise3.setOffset(0,16);
                    this.physics.add.collider(player,this.chaise3,this.bumper3,null,this);

                    this.chaise4 = this.physics.add.sprite(3560,2400,"chaise");
                    this.physics.add.collider(this.chaise4, sol);
                    this.chaise4.setImmovable(true);
                    this.chaise4.setSize(32, 32);
                    this.chaise4.setOffset(0,16);
                    this.physics.add.collider(player,this.chaise4,this.bumper4,null,this);

                    this.chaise5 = this.physics.add.sprite(3400,2200,"chaise");
                    this.physics.add.collider(this.chaise5, sol);
                    this.chaise5.setImmovable(true);
                    this.chaise5.setSize(32, 32);
                    this.chaise5.setOffset(0,16);
                    this.physics.add.collider(player,this.chaise5,this.bumper5,null,this);

                    this.chaise6 = this.physics.add.sprite(3700,1900,"chaise");
                    this.physics.add.collider(this.chaise6, sol);
                    this.chaise6.setImmovable(true);
                    this.chaise6.setSize(32, 32);
                    this.chaise6.setOffset(0,16);
                    this.physics.add.collider(player,this.chaise6,this.bumper6,null,this);

                    this.chaise7 = this.physics.add.sprite(7480,1600,"chaise");
                    this.physics.add.collider(this.chaise7, sol);
                    this.chaise7.setImmovable(true);
                    this.chaise7.setSize(32, 32);
                    this.chaise7.setOffset(0,16);
                    this.physics.add.collider(player,this.chaise7,this.bumper7,null,this);

                    this.chaise8 = this.physics.add.sprite(7540,1180,"chaise");
                    this.physics.add.collider(this.chaise8, sol);
                    this.chaise8.setImmovable(true);
                    this.chaise8.setSize(32, 32);
                    this.chaise8.setOffset(0,16);
                    this.physics.add.collider(player,this.chaise8,this.bumper8,null,this);



                    this.anims.create({
                    key: "leftg",
                    frames: this.anims.generateFrameNumbers("dude", { start: 9, end:12 }),
                    frameRate: 10,
                    repeat: -1
                    });

                    // animation du perso lorsque le personnage n'avance pas
                    this.anims.create({
                    key: "turng",
                    frames: [{ key: "dude", frame: 13 }],
                    frameRate: 20
                    });

                    // animation du perso pour tourner à droite
                    this.anims.create({
                    key: "rightg",
                    frames: this.anims.generateFrameNumbers("dude", { start: 15, end: 18 }),
                    frameRate: 10,
                    repeat: -1
                    });

                    
                    




                    // création d'un écouteur sur le cursors
                    cursors = this.input.keyboard.createCursorKeys();

                    // redimentionnement du monde avec les dimensions calculées via tiled
                    this.physics.world.setBounds(0, 0, 9999, 6400);
                    //  ajout du champs de la caméra de taille identique à celle du monde
                    this.cameras.main.setBounds(0, 0, 9999, 6400);
                    // ancrage de la caméra sur le joueur
                    this.cameras.main.startFollow(player); 


                    //this.anims.create({
                    //key: 'virusactif',
                    //frames: this.anims.generateFrameNumbers('virus', { start: 0, end: 1 }),
                    //frameRate: 10,
                    //repeat: -1
                    //});




                    this.hitboxfantom = this.physics.add.sprite(4500,2100,"attak");
                    this.hitboxfantom.setImmovable();
                    this.hitboxfantom.body.setAllowGravity(false);
                    this.hitboxfantom.setSize(10, 800);
                    this.physics.add.collider(player, this.hitboxfantom,this.apparitionfantom,null,this);




                    var startPoint = new Phaser.Math.Vector2(4100, 2150);
                    var controlPoint1 = new Phaser.Math.Vector2(6200, 2150);
                    var controlPoint2 = new Phaser.Math.Vector2(6230, 2150);
                    var controlPoint3 = new Phaser.Math.Vector2(6600, 1670);



                    var curve = new Phaser.Curves.CubicBezier(startPoint, controlPoint1, controlPoint2,controlPoint3);

                    var graphics = this.add.graphics();



                    this.fantom = this.add.follower(curve, 100,100, 'fantom').setInteractive();
                    this.physics.add.existing(this.fantom);
                    this.fantom.body.setAllowGravity(false)
                    //this.followvirus.anims.play('virusactif', true)
                    
                    
                    this.fantom.setSize(346, 511);
                    this.fantom.visible = false;
                    this.physics.add.collider(player, this.fantom,this.degatsfantom,null,this);
                    
                    
                    

                    if(this.fantom.x >= 4100){
                        this.nacelle1.setVelocityX(75);
                    }
                    if (this.fantom.x >= 6200){
                        this.fantom.setVelocityX(75);
                    }
                    if (this.fantom.x >= 6200){
                        this.fantom.setVelocityX(75);
                    }



                    //spectres
                    this.EnnemiUn = this.physics.add.sprite(6200,2000, 'zoneattack');
                    this.physics.add.collider(player, this.EnnemiUn,this.degats,null,this);
                    this.physics.add.collider(this.zoneattack, this.EnnemiUn,this.degatsennemi6,null,this);
                    this.EnnemiUn.setImmovable();
                    this.EnnemiUn.body.setAllowGravity(false);
                    this.SpriteHitBoxUn = this.physics.add.sprite(this.EnnemiUn.x, this.EnnemiUn.y, 'zoneattack').setSize(128, 128);
                    this.physics.add.overlap( player,this.SpriteHitBoxUn, this.EnnemiUnAggro, null, this);
                    this.SpriteHitBoxUn.setImmovable();
                    this.SpriteHitBoxUn.body.setAllowGravity(false);


                    this.Ennemi2 = this.physics.add.sprite(3300,2000, 'zoneattack');
                    this.physics.add.collider(player, this.Ennemi2,this.degats,null,this);
                    this.physics.add.collider(this.zoneattack, this.Ennemi2,this.degatsennemi8,null,this);
                    this.Ennemi2.setImmovable();
                    this.Ennemi2.body.setAllowGravity(false);
                    this.SpriteHitBox2 = this.physics.add.sprite(this.Ennemi2.x, this.Ennemi2.y, 'zoneattack').setSize(128, 128);
                    this.physics.add.overlap( player,this.SpriteHitBox2, this.Ennemi2Aggro, null, this);
                    this.SpriteHitBox2.setImmovable();
                    this.SpriteHitBox2.body.setAllowGravity(false);



                    this.Ennemi3 = this.physics.add.sprite(1500,3400, 'zoneattack');
                    this.physics.add.collider(player, this.Ennemi3,this.degats,null,this);
                    this.physics.add.collider(this.zoneattack, this.Ennemi3,this.degatsennemi9,null,this);
                    this.Ennemi3.setImmovable();
                    this.Ennemi3.body.setAllowGravity(false);
                    this.SpriteHitBox3 = this.physics.add.sprite(this.Ennemi3.x, this.Ennemi3.y, 'zoneattack').setSize(128, 128);
                    this.physics.add.overlap( player,this.SpriteHitBox3, this.Ennemi3Aggro, null, this);
                    this.SpriteHitBox3.setImmovable();
                    this.SpriteHitBox3.body.setAllowGravity(false);


                    this.Ennemi4 = this.physics.add.sprite(1100,1698, 'zoneattack');
                    this.physics.add.collider(player, this.Ennemi4,this.degats,null,this);
                    this.physics.add.collider(this.zoneattack, this.Ennemi4,this.degatsennemi12,null,this);
                    this.Ennemi4.setImmovable();
                    this.Ennemi4.body.setAllowGravity(false);
                    this.SpriteHitBox4 = this.physics.add.sprite(this.Ennemi4.x, this.Ennemi4.y, 'zoneattack').setSize(128, 128);
                    this.physics.add.overlap( player,this.SpriteHitBox4, this.Ennemi4Aggro, null, this);
                    this.SpriteHitBox4.setImmovable();
                    this.SpriteHitBox4.body.setAllowGravity(false);






                    
                    //Action de la zone d'attaque
                    
                    this.physics.add.collider(this.zoneattack, this.ennemivol,this.degatsennemi2,null,this);
                    this.physics.add.collider(this.zoneattack, this.ennemivol2,this.degatsennemi3,null,this);
                    this.physics.add.collider(this.zoneattack, this.ennemiterre,this.degatsennemi4,null,this);
                    

                    

                    this.nuit = this.add.sprite(550, 475, 'nuit').setScrollFactor(0);
                    this.nuit.alpha = 0.8;
                    this.nuit.visible = false;


                    //projecteurs
                    this.projo1 = this.physics.add.sprite(1280,3680,"projohorizon");
                    this.projo1.setImmovable();
                    this.projo1.body.setAllowGravity(false);
                    this.projo1.setSize(370,50);
                    this.projo1.setOffset(0,32);
                    this.projo1.setScale(0.4)
                    this.physics.add.collider(player, this.projo1,this.degats,null,this);

                    this.projo2 = this.physics.add.sprite(860,2490,"projohorizon");
                    this.projo2.setImmovable();
                    this.projo2.setAngle(180)
                    this.projo2.body.setAllowGravity(false);
                    this.projo2.setSize(370,50);
                    this.projo2.setOffset(0,32);
                    this.projo2.setScale(0.4)
                    this.physics.add.collider(player, this.projo2,this.degats,null,this);


                    this.projo3 = this.physics.add.sprite(1900,2530,"projo");
                    this.projo3.setImmovable();
                    this.projo3.body.setAllowGravity(false);
                    this.projo3.setSize(50,370);
                    this.projo3.setOffset(32,0);
                    this.projo3.setScale(0.4)
                    this.physics.add.collider(player, this.projo3,this.degats,null,this);

                    this.projo4 = this.physics.add.sprite(2200,2530,"projo");
                    this.projo4.setImmovable();
                    this.projo4.body.setAllowGravity(false);
                    this.projo4.setSize(50,370);
                    this.projo4.setOffset(32,0);
                    this.projo4.setScale(0.4)
                    this.physics.add.collider(player, this.projo4,this.degats,null,this);

                    this.projo5 = this.physics.add.sprite(2620,2960,"projohorizon");
                    this.projo5.setImmovable();
                    this.projo5.body.setAllowGravity(false);
                    this.projo5.setSize(370,50);
                    this.projo5.setOffset(0,32);
                    this.projo5.setScale(0.8)
                    this.physics.add.collider(player, this.projo5,this.degats,null,this);

                    this.projo6 = this.physics.add.sprite(1760,1260,"projo");
                    this.projo6.setImmovable();
                    this.projo6.body.setAllowGravity(false);
                    this.projo6.setSize(50,370);
                    this.projo6.setOffset(32,0);
                    this.projo6.setScale(0.5)
                    this.physics.add.collider(player, this.projo6,this.degats,null,this);


                

                    this.vuedoki = this.add.sprite(448, 225, 'vuedoki').setScrollFactor(0);
                    this.vuedoki.alpha = 0.8;
                    this.vuedoki.visible = false;


                    this.grpprojo = this.physics.add.group({ immovable: true, allowGravity: false })
                    this.lumiere = this.map.getObjectLayer("projecteurs");
                    this.lumiere.objects.forEach(coord => {
                        this.grpprojo.create(coord.x + 32, coord.y + 79, "projo");
                    });
                    this.grpprojo.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setSize(50, 370);
                        child.setOffset(32,0);
                        child.setScale(0.8)
                        }, this)


                    this.grpprojohorizon = this.physics.add.group({ immovable: true, allowGravity: false })
                    this.lumierehorizon = this.map.getObjectLayer("projecteurshorizon");
                    this.lumierehorizon.objects.forEach(coord => {
                        this.grpprojohorizon.create(coord.x - 64, coord.y, "projohorizon");
                    });
                    this.grpprojohorizon.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setSize(370, 50);
                        child.setOffset(32,64);
                        child.setScale(0.7)
                        }, this)

                    this.physics.add.overlap(player, this.grpprojo, this.degats, null, this);
                    this.physics.add.overlap(player, this.grpprojohorizon, this.degats, null, this);

                    
                    this.timedEvent = new Phaser.Time.TimerEvent({ delay: 30000, callback: this.degatschrono, callbackScope: this, loop: true});
                    this.time.addEvent(this.timedEvent);

                    this.timedEventprojo = new Phaser.Time.TimerEvent({ delay: 1250, callback: this.projoeteint, callbackScope: this, loop: true});
                    this.time.addEvent(this.timedEventprojo);

                    this.timedEventprojo2 = new Phaser.Time.TimerEvent({ delay: 2500, callback: this.projoallumee, callbackScope: this, loop: true});
                    this.time.addEvent(this.timedEventprojo2);


                    //ecran de chargement et de transition
                    //this.transition = this.add.sprite(448, 225, 'transition').setScrollFactor(0);
                    //this.transition.anims.play('transitionclap', true)
                

                    
                


            }

            update() {

                    
                    
                    console.log(safe)
                    scoreText.setText(PV)

                    


                    if(this.projo3.x >= 2100){
                        this.projo3.setVelocityX(-75);
                    }
                    else if (this.projo3.x <= 1900){
                       this.projo3.setVelocityX(75);
                    }

                    if(this.projo4.x >= 2400){
                        this.projo4.setVelocityX(-75);
                    }
                    else if (this.projo4.x <= 2200){
                       this.projo4.setVelocityX(75);
                    }

                    if(this.projo6.x >= 1760){
                        this.projo6.setVelocityX(-75);
                    }
                    else if (this.projo6.x <= 1400){
                       this.projo6.setVelocityX(75);
                    }


                    







                    


                    if(this.ennemiterre.x >= 5350){
                        this.ennemiterre.setVelocityX(-75);
                    }
                    else if (this.ennemiterre.x <= 5200){
                        this.ennemiterre.setVelocityX(75);
                    }

                    if(this.ennemiterre2.x >= 7100){
                        this.ennemiterre2.setVelocityX(-75);
                    }
                    else if (this.ennemiterre2.x <= 6950){
                        this.ennemiterre2.setVelocityX(75);
                    }





                if (keyA.isDown && changecaract == false) {
                    if(safe == true){
                        pologlace = true
                    }
                    
                    setTimeout(() => {
                    changecaract = true
                                }, 170);
                            
                
                }
                else if (keyA.isDown && changecaract == true) {
                    if(safe == true){
                        pologlace = false
                    }
                    this.time.addEvent(this.timedEvent);
                    setTimeout(() => {
                    changecaract = false
                                }, 170);
                            

                }

                if (pologlace == true){
                    player.setGravity(0, -300)
                    this.nuit.visible = true;
                    this.vuedoki.visible = true;
                    this.grpprojo.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(32,0);
                    }, this)

                    this.grpprojohorizon.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(0,32);
                    }, this)

                    this.grppobscur.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(0,-5000);
                    }, this)

                    this.grpshine.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(0,0);
                    }, this)

                        if (cursors.left.isDown) {
                        player.setVelocityX(-220);
                        player.anims.play("leftg", true);

                        // à droite
                    } else if (cursors.right.isDown) {
                        player.setVelocityX(220);
                        player.anims.play("rightg", true);
                    }
                    // immoobile
                    else {
                        player.setVelocityX(0);
                        player.anims.play("turng");
                    }
                    // en saut (important : blocked doown au lieu de tuoching down)
                    if (cursors.up.isDown && player.body.blocked.down) {
                        player.setVelocityY(-50);
                    }
                    if ((cursors.up.isDown && player.body.blocked.down)){
                            //si touche haut appuyée ET que le perso touche le sol
                            player.setVelocityY(-228); //alors vitesse verticale négative
                    }
                    
                            if (keyZ.isDown && lanceattack == true) {
                            attaque = true
                            lanceattack = false
                            setTimeout(() => {
                                attaque = false
                                this.zoneattack.y = -5000
                                this.zoneattack.x = -5000
                            }, 200);
                            setTimeout(() => {
                                lanceattack = true
                            }, 700);
                        }
                        if (attaque == true) {
                            this.zoneattack.y = player.y - 29
                            this.zoneattack.x = player.x - 29
                        }

                    //changement etat des portes
                    

                    
                    //this.projo1.setOffset(30,0);
                    //this.projo2.setOffset(30,0);
                    
                }
                    else if (pologlace == false){

                        player.setGravity(0, 0)
                        this.grpprojo.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(0,-5000);
                        }, this)

                        this.grpprojohorizon.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(0,-5000);
                        }, this)

                        this.nuit.visible = false;
                        this.vuedoki.visible = false;
                        this.grppobscur.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(0,0);
                        }, this)

                        this.grpshine.getChildren().forEach(function (child) {
                        //child.setOffset(5000,32);
                        child.setOffset(0,-5000);
                        }, this)


                    // a gauche
                        if (cursors.left.isDown) {
                        player.setVelocityX(-400);
                        player.anims.play("left", true);

                        // à droite
                        } else if (cursors.right.isDown) {
                        player.setVelocityX(400);
                        player.anims.play("right", true);
                        }
                        // immoobile
                        else {
                        player.setVelocityX(0);
                        player.anims.play("turn");
                        }
                        //lorsdupremier saut, possibilité de double jump
                        if ((cursors.up.isDown && player.body.blocked.down)){
                            player.setVelocityY(-300);
                            doublejump = 0
                            setTimeout(() => {
                                doublejump = 1
                            
                                }, 300);
                        }
                        //Doublejump effectuer, un seul disponible après utilisation !
                        if ((cursors.up.isDown && doublejump == 1)){
                                    player.setVelocityY(-300);
                                    doublejump = 0
                        }
                        if ((player.body.blocked.down)){
                                    doublejump = 1
                        }


                        if (keyZ.isDown && lanceattack == true) {
                            attaque = true
                            lanceattack = false
                            setTimeout(() => {
                                attaque = false
                                this.zoneattack.y = -5000
                                this.zoneattack.x = -5000
                            }, 200);
                            setTimeout(() => {
                                lanceattack = true
                            }, 700);
                        }
                        if (attaque == true) {
                            this.zoneattack.y = player.y - 29
                            this.zoneattack.x = player.x - 29
                        }







                        
                        //changement etat des portes
                        
                        //this.projo1.setOffset(-5000,0);
                        //this.projo2.setOffset(-5000,0);
                        
                        if(repousseright == true){
                            
                            console.log("repousser !")
                        }
                        
                        
                    }
                

                    player.body.setAllowGravity(true)
                if (gameOver){return;}

                

                if (this.EnnemiUnFollow == true) {
                    this.EnnemiUn.setVelocityX(player.x - this.EnnemiUn.x);
                    this.EnnemiUn.setVelocityY(player.y - this.EnnemiUn.y);
                }

                if (this.Ennemi2Follow == true) {
                    this.Ennemi2.setVelocityX(player.x - this.Ennemi2.x);
                    this.Ennemi2.setVelocityY(player.y - this.Ennemi2.y);
                }

                if (this.Ennemi3Follow == true) {
                    this.Ennemi3.setVelocityX(player.x - this.Ennemi3.x);
                    this.Ennemi3.setVelocityY(player.y - this.Ennemi3.y);
                }

                if (this.Ennemi4Follow == true) {
                    this.Ennemi4.setVelocityX(player.x - this.Ennemi4.x);
                    this.Ennemi4.setVelocityY(player.y - this.Ennemi4.y);
                }

                        



                
            }

                

                degats() {
                

                    if (PV >= 1 && tempsdegats == false){
                        PV = 0
                        tempsdegats = true
                        cursors.right.reset();
                        cursors.left.reset();
                        cursors.up.reset();
                        cursors.down.reset();
                        repousseright = true
                        player.alpha = 0.5
                        player.setVelocityY(-60)
                        player.setVelocityX(-300)
                        this.serolReset = this.time.addEvent({
                        delay: 4000,
                        callback: ()=>{
                            tempsdegats = false
                            player.alpha = 1;
                            ;
                        },
                        loop: false
                        })
                    this.serolReset = this.time.addEvent({
                        delay: 500,
                        callback: ()=>{
                            repousseright = false
                            cursors.right.enabled = true;
                            cursors.left.enabled = true;
                            cursors.up.enabled = true;
                            cursors.down.enabled = true;
                        },
                        loop: false
                    })
                    console.log("aie")
                    }
                
                    

                    if (PV == 0 && tempsdegats == false){
                        this.physics.pause();
                        player.setTint(0xff0000);
                        player.anims.play('turn');
                        gameOver = true;
                        console.log("aie2")
                    }
                    
                
                }



                degatschrono() {
                

                if (PV >= 1 && pologlace == false){
                    cursors.right.reset();
                    cursors.left.reset();
                    cursors.up.reset();
                    cursors.down.reset();
                    cursors.right.enabled = false;
                    cursors.left.enabled = false;
                    cursors.up.enabled = false;
                    cursors.down.enabled = false;
                    player.setVelocityY(0)
                    player.setVelocityX(0)
                    repousseright = true
                    player.alpha = 0.5
                    this.serolReset = this.time.addEvent({
                    delay: 4000,
                    callback: ()=>{
                        player.alpha = 1;
                        PV = 0;
                    },
                    loop: false
                    })
                this.serolReset = this.time.addEvent({
                    delay: 1700,
                    callback: ()=>{
                        repousseright = false
                        cursors.right.enabled = true;
                        cursors.left.enabled = true;
                        cursors.up.enabled = true;
                        cursors.down.enabled = true;
                    },
                    loop: false
                })
                console.log("aie")
                }
            
                

                if (PV == 0 && pologlace == false){
                    this.physics.pause();
                    player.setTint(0xff0000);
                    player.anims.play('turn');
                    gameOver = true;
                    console.log("aie2")
                }
                

            }



            EnnemiUnAggro() {
                this.EnnemiUnFollow = true;
                this.SpriteHitBoxUn.destroy()
            }

            Ennemi2Aggro() {
                this.Ennemi2Follow = true;
                this.SpriteHitBox2.destroy()
            }

            Ennemi3Aggro() {
                this.Ennemi3Follow = true;
                this.SpriteHitBox3.destroy()
            }

            Ennemi4Aggro() {
                this.Ennemi4Follow = true;
                this.SpriteHitBox4.destroy()
            }









                projoeteint() {
                this.projo1.setOffset(0,5000);
                this.projo5.setOffset(0,5000);

                }

                projoallumee() {
                this.projo1.setOffset(0,32);
                this.projo5.setOffset(0,32);

                }

                


                apparitionfantom() {
                    this.hitboxfantom.destroy()
                    this.fantom.x = 4200
                    this.fantom.y = 2150
                    this.fantom.visible = true;
                    this.fantom.startFollow({
                        duration: 30000,
                        yoyo: false,
                        
                        
                    });
                }

                degatsfantom() {
                    this.physics.pause();
                    player.setTint(0xff0000);
                    player.anims.play('turn');
                    gameOver = true;
                    console.log("aie2")
                }





                degatsennemi() {
                    this.followvirus.destroy()
                }
                degatsennemi2() {
                    this.ennemivol.destroy()
                }
                degatsennemi3() {
                    this.ennemivol2.destroy()
                }
                degatsennemi4() {
                    this.ennemiterre.destroy()
                }

                degatsennemi5() {
                    this.ennemiterre2.destroy()
                }

                degatsennemi6() {
                    this.EnnemiUnFollow = false
                    this.EnnemiUn.destroy()
                }

                degatsennemi7() {
                    this.ennemivol3.destroy()
                }

                degatsennemi8() {
                    this.Ennemi2Follow = false
                    this.Ennemi2.destroy()
                }

                degatsennemi9() {
                    this.Ennemi3Follow = false
                    this.Ennemi3.destroy()
                }


                degatsennemi10() {
                    this.ennemivol4.destroy()
                }

                degatsennemi11() {
                    this.ennemivol5.destroy()
                }

                degatsennemi12() {
                    this.Ennemi4Follow = false
                    this.Ennemi4.destroy()
                }


                ennemitombe() {
                    this.hitbox.destroy()
                    this.ennemivol.body.setAllowGravity(true)

                }

                ennemitombe2() {
                    this.hitbox2.destroy()
                    this.ennemivol2.body.setAllowGravity(true)

                }

                ennemitombe3() {
                    this.hitbox3.destroy()
                    this.ennemivol3.body.setAllowGravity(true)

                }

                ennemitombe4() {
                    this.hitbox4.destroy()
                    this.ennemivol4.body.setAllowGravity(true)

                }

                ennemitombe5() {
                    this.hitbox5.destroy()
                    this.ennemivol5.body.setAllowGravity(true)

                }



                

                switch() {
                    safe = true
                    setTimeout(() => {
                    safe = false
                                }, 90);
                    

                }


                collectpop(player, pop){
                PV += 1; //augmente le score de 1
                 // l’étoile disparaît
                pop.destroy()
                }


                bumper1() {
                    this.chaise1.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-600)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-400)
                    }
                    
                

                }

                bumper2() {
                    this.chaise2.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-730)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-530)
                    }
                    
                

                }

                bumper3() {
                    this.chaise3.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-700)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-500)
                    }
                    
                

                }

                bumper4() {
                    this.chaise4.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-460)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-370)
                    }
                    
                

                }

                bumper5() {
                    this.chaise5.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-700)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-500)
                    }
                    
                

                }


                bumper6() {
                    this.chaise6.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-400)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-300)
                    }
                    
                

                }

                bumper7() {
                    this.chaise7.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-900)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-300)
                    }
                    
                

                }

                bumper8() {
                    this.chaise8.anims.play('chaise', true)
                    if(pologlace== false){
                        player.setVelocityY(-800)
                    }
                    if(pologlace == true){
                        player.setVelocityY(-300)
                    }
                    
                

                }




                escalade() {
                    if (pologlace == true){
                        player.body.setAllowGravity(false)
                        player.setVelocityX(0);
                        player.setVelocityY(0);
                        if (cursors.up.isDown) {
                        player.setVelocityY(-100);
                        }
                        if ((cursors.down.isDown)){
                                //si touche haut appuyée ET que le perso touche le sol
                                player.setVelocityY(100); //alors vitesse verticale négative
                        }

                    }

                }

            }





























                            class City extends Phaser.Scene {


                constructor() {

                    super("City")
                }




                preload() {
                        // chargement du personnage
                    this.load.spritesheet("dude", "assets/Polo.png", {
                        frameWidth: 32,
                        frameHeight: 64
                    });

                    this.load.spritesheet("dude2", "assets/Pologlace.png", {
                        frameWidth: 32,
                        frameHeight: 64
                    });

                    this.load.spritesheet("dudeglace", "assets/Pologlace.png", {
                        frameWidth: 32,
                        frameHeight: 64
                    });



                    this.load.spritesheet("bitcoin", "assets/bitcoin.png", {
                        frameWidth: 32,
                        frameHeight: 32,
                    });

                    this.load.spritesheet("popcorn", "assets/popcorn.png", {
                        frameWidth: 32,
                        frameHeight: 48,
                    });


                    this.load.spritesheet("click", "assets/click.png", {
                        frameWidth: 32,
                        frameHeight: 32,
                    });
                    this.load.spritesheet("porte", "assets/portes.png", {
                        frameWidth: 64,
                        frameHeight: 64,
                    });

                    this.load.spritesheet("nacelle", "assets/nacellemobile.png", {
                        frameWidth: 96,
                        frameHeight: 64,
                    });

                    this.load.spritesheet("zoneattack", "assets/attack.png", {
                        frameWidth: 64,
                        frameHeight: 64,
                    });

                    this.load.spritesheet("ennemivol", "assets/ennemivol.png", {
                        frameWidth: 64,
                        frameHeight: 32,
                    });

                    this.load.spritesheet("ennemiterre", "assets/ennemiterre.png", {
                        frameWidth: 32,
                        frameHeight: 64,
                    });

                    this.load.spritesheet("miniobscur", "assets/miniobscur.png", {
                        frameWidth: 32,
                        frameHeight: 32,
                    });

                    this.load.spritesheet("shine", "assets/shine.png", {
                        frameWidth: 32,
                        frameHeight: 32,
                    });

                    this.load.spritesheet("safe", "assets/safe.png", {
                        frameWidth: 32,
                        frameHeight: 32,
                    });

                    this.load.image("vuedoki", "assets/vuedoki.png" );


                    // chargement tuiles de jeu
                    this.load.image("Phaser_Tileset", "assets/Placedoki.png");

                    // chargement de la carte
                    this.load.tilemapTiledJSON("carte", "assets/City.json");

                    this.load.image("interfacefenetre", "assets/fenetre clean.png" );

                    this.load.image("interfacenormal", "assets/interface full.png" );

                    this.load.image("interfacedegats", "assets/interface degats.png" );
                    this.load.spritesheet("virus", "assets/mobile.png", {
                        frameWidth: 32,
                        frameHeight: 32,
                    });
                    this.load.image('nuit', 'assets/nuit.png');
                    this.load.spritesheet("projo", "assets/projo.png", {
                            frameWidth: 370,
                            frameHeight: 109,
                        });

                        this.load.spritesheet("projohorizon", "assets/projohorizon.png", {
                            frameWidth: 109,
                            frameHeight: 370,
                        });


                        this.load.spritesheet("grandmissile", "assets/grandmissile.png", {
                            frameWidth: 436,
                            frameHeight: 46,
                        });

                        this.load.spritesheet("grandrond", "assets/grandrond.png", {
                            frameWidth: 518,
                            frameHeight: 518,
                        });

                        this.load.spritesheet("petitrond", "assets/petitrond.png", {
                            frameWidth: 105,
                            frameHeight: 105,
                        });

                        this.load.spritesheet("transition", "assets/transition.png", {
                            frameWidth: 896,
                            frameHeight: 448,
                        });

                        this.load.spritesheet("obscur", "assets/obscur.png", {
                            frameWidth: 371,
                            frameHeight: 207,
                        });

                        this.load.spritesheet("chaise", "assets/chaise.png", {
                            frameWidth: 32,
                            frameHeight: 48,
                        });

                        this.load.spritesheet("fantom", "assets/fantom.png", {
                            frameWidth: 346,
                            frameHeight: 511,
                        });
                        
                        
                    

                }


                create() {

                        pologlace = false
                        this.map = this.add.tilemap("carte");
                        // chargement de la carte du niveau
                        const carteDuNiveau = this.add.tilemap("carte");
                        // chargement du jeu de tuiles
                        const tileset = carteDuNiveau.addTilesetImage(
                        "Placedoki",
                        "Phaser_Tileset"
                        );

                        const fond = carteDuNiveau.createStaticLayer(
                        "fond",
                        tileset
                        );

                        // chargement du calque "calque_backgroung"
                        const deco = carteDuNiveau.createStaticLayer(
                        "deco",
                        tileset
                        );



                        // chargement du calque "calque_plateformes""
                        const sol = carteDuNiveau.createStaticLayer(
                        "sol",
                        tileset
                        );

                        // chargement du calque "calque_plateformes""
                        const grimpette = carteDuNiveau.createStaticLayer(
                        "grimpette",
                        tileset
                        );

                        this.popcorns = this.map.createLayer(
                            "popcornss",
                            this.tileset
                        );

                        this.obscurite = this.map.createLayer(
                            "obscurite",
                            this.tileset
                        );

                        this.shine = this.map.createLayer(
                            "shine",
                            this.tileset
                        );

                        this.projecteurs = this.map.createLayer(
                            "projecteurs",
                            this.tileset
                        );

                        this.projecteurshorizon = this.map.createLayer(
                            "projecteurshorizon",
                            this.tileset
                        );

                        this.switchplace = this.map.createLayer(
                            "safespot",
                            this.tileset
                        );



                        player = this.physics.add.sprite(700,3200,"dude");
                        //player = this.physics.add.sprite(7300,300,"dude");




                        this.grppopcorns = this.physics.add.group({ immovable: true, allowGravity: false })
                        this.pop = this.map.getObjectLayer("popcornss");
                        this.pop.objects.forEach(coord => {
                            this.grppopcorns.create(coord.x, coord.y - 32, "popcorn");
                        });

                        this.grppobscur = this.physics.add.group({ immovable: true, allowGravity: false })
                        this.ombre = this.map.getObjectLayer("obscurite");
                        this.ombre.objects.forEach(coord => {
                            this.grppobscur.create(coord.x + 16, coord.y - 16, "miniobscur");
                        });

                        this.grpshine = this.physics.add.group({ immovable: true, allowGravity: false })
                        this.brillant = this.map.getObjectLayer("shine");
                        this.brillant.objects.forEach(coord => {
                            this.grpshine.create(coord.x + 16, coord.y - 16, "shine");
                        });

                        this.grpsafe = this.physics.add.group({ immovable: true, allowGravity: false })
                        this.safespot = this.map.getObjectLayer("safespot");
                        this.safespot.objects.forEach(coord => {
                            this.grpsafe.create(coord.x + 16, coord.y - 16, "safe");
                        });

                    
                        
                        

                        //affichage de l'interface
                        this.add.image(120,75, "interfacefenetre").setScrollFactor(0);
                        this.add.image(120,75, "interfacenormal").setScrollFactor(0);
                        //affiche un texte à l’écran, pour le score
                        
                        scoreText=this.add.text(175,100,'0',{fontSize:'32px',fill:'#000'}).setScrollFactor(0);

                        
                        var doublejump = 0
                        

                        // définition des objets solides avec lesquels le personnage va interagir
                        sol.setCollisionByProperty({ solide: true });
                        grimpette.setCollisionByProperty({ grimpe: true });

                        //nacceles
                        
                        
                    

                        // création du personnage de jeu et positionnement
                        
                        
                        keyA = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
                        keyZ = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Z);

                        // ajout du modèle de collision entre le personnage et les plates-formes et les ennemis et les piques
                        this.physics.add.collider(player, sol);
                        this.physics.add.collider(player, grimpette,this.escalade);
                        this.physics.add.overlap(player, this.grppobscur, this.degats, null, this);
                        this.physics.add.overlap(player, this.grpshine, this.degats, null, this);
                        this.physics.add.overlap(player, this.grpsafe, this.switch, null, this);
                        
                        
                        
                        

                        gameOver = false;



                        // ajout du modèle de collision entre le personnage et le monde
                        player.setCollideWorldBounds(true);

                        
                        

                        // animation du perso pour tourner à gauche
                        this.anims.create({
                        key: "left",
                        frames: this.anims.generateFrameNumbers("dude", { start: 0, end: 3 }),
                        frameRate: 10,
                        repeat: -1
                        });

                        // animation du perso lorsque le personnage n'avance pas
                        this.anims.create({
                        key: "turn",
                        frames: [{ key: "dude", frame: 4 }],
                        frameRate: 20
                        });

                        // animation du perso pour tourner à droite
                        this.anims.create({
                        key: "right",
                        frames: this.anims.generateFrameNumbers("dude", { start: 5, end: 8 }),
                        frameRate: 10,
                        repeat: -1
                        });


                        //animation des portes
                        this.anims.create({
                        key: "portesoleilouverte",
                        frames: this.anims.generateFrameNumbers("porte", { start: 1, end: 1 }),
                        frameRate: 10,
                        });
                        this.anims.create({
                        key: "portesoleilfermee",
                        frames: this.anims.generateFrameNumbers("porte", { start: 0, end: 0 }),
                        frameRate: 10,
                        });

                        this.anims.create({
                        key: "porteluneouverte",
                        frames: this.anims.generateFrameNumbers("porte", { start: 3}),
                        frameRate: 10,
                        
                        });
                        this.anims.create({
                        key: "portelunefermee",
                        frames: this.anims.generateFrameNumbers("porte", { start: 1, end: 1 }),
                        frameRate: 10,
                        });

                        this.anims.create({
                        key: "nacelleallumee",
                        frames: this.anims.generateFrameNumbers("nacelle", { start: 0, end: 5 }),
                        frameRate: 10,
                        repeat: -1
                        });
                        this.anims.create({
                        key: "popcorn",
                        frames: this.anims.generateFrameNumbers("popcorn", { start: 0, end: 7 }),
                        frameRate: 10,
                        repeat: -1
                        });

                        this.anims.create({
                        key: "chaise",
                        frames: this.anims.generateFrameNumbers("chaise", { start: 0, end: 9 }),
                        frameRate: 20,
                        repeat: -1
                        });


                        this.zoneattack = this.physics.add.sprite(100,1400,"zoneattack");
                        this.zoneattack.setCircle(48);
                        this.zoneattack.setImmovable();
                        this.zoneattack.body.setAllowGravity(false)
                        
                        //popcorns
                        
                        this.grppopcorns.getChildren().forEach(function (child) {
                            //child.setOffset(5000,32);
                            child.anims.play('popcorn', true)
                        }, this)
                        this.physics.add.overlap(player, this.grppopcorns, this.collectpop, null, this);

                        //nacelles
                        this.nacelle1 = this.physics.add.sprite(8190,1900,"nacelle");
                        this.nacelle1.setImmovable();
                        this.nacelle1.body.setAllowGravity(false);
                        this.physics.add.collider(player,this.nacelle1);
                        this.nacelle1.anims.play('nacelleallumee', true)
                        this.nacelle1.setSize(200, 32);
                        this.nacelle1.setOffset(-50,32);

                        this.nacelle2 = this.physics.add.sprite(8470,2325,"nacelle");
                        this.nacelle2.setImmovable();
                        this.nacelle2.body.setAllowGravity(false);
                        this.physics.add.collider(player,this.nacelle2);
                        this.nacelle2.anims.play('nacelleallumee', true)
                        this.nacelle2.setSize(200, 32);
                        this.nacelle2.setOffset(-50,32);

                        



                        


                        //ennemivol
                        this.ennemivol = this.physics.add.sprite(2100,880,"ennemivol");
                        this.physics.add.collider(this.ennemivol, sol);
                        this.ennemivol.body.setAllowGravity(false)
                        this.ennemivol.setImmovable(true);
                        this.physics.add.collider(player,this.ennemivol,this.degats,null,this);

                        this.hitbox = this.physics.add.sprite(2100,880,"ennemivol");
                        this.hitbox.body.setAllowGravity(false)
                        this.hitbox.setImmovable(true);
                        this.hitbox.setSize(64, 300);
                        this.hitbox.setOffset(0,0);
                        this.physics.add.collider(player,this.hitbox,this.ennemitombe,null,this);



                        this.ennemivol2 = this.physics.add.sprite(5935,885,"ennemivol");
                        this.physics.add.collider(this.ennemivol2, sol);
                        this.ennemivol2.body.setAllowGravity(false)
                        this.ennemivol2.setImmovable(true);
                        this.physics.add.collider(player,this.ennemivol2,this.degats,null,this);

                        this.hitbox2 = this.physics.add.sprite(5935,885,"ennemivol");
                        this.hitbox2.body.setAllowGravity(false)
                        this.hitbox2.setImmovable(true);
                        this.hitbox2.setSize(64, 300);
                        this.hitbox2.setOffset(0,0);
                        this.physics.add.collider(player,this.hitbox2,this.ennemitombe2,null,this);


                        this.ennemivol3 = this.physics.add.sprite(4390,980,"ennemivol");
                        this.physics.add.collider(this.ennemivol3, sol);
                        this.ennemivol3.setSize(32, 98);
                        this.ennemivol3.body.setAllowGravity(false)
                        this.ennemivol3.setImmovable(true);
                        this.physics.add.collider(this.zoneattack,this.ennemivol3,this.degatsennemi7,null,this);
                        this.physics.add.collider(player,this.ennemivol3,this.degats,null,this);

                        this.hitbox3 = this.physics.add.sprite(4390,980,"ennemivol");
                        this.hitbox3.body.setAllowGravity(false)
                        this.hitbox3.setImmovable(true);
                        this.hitbox3.setSize(64, 300);
                        this.hitbox3.setOffset(0,0);
                        this.physics.add.collider(player,this.hitbox3,this.ennemitombe3,null,this);


                        this.ennemivol4 = this.physics.add.sprite(980,3100,"ennemivol");
                        this.physics.add.collider(this.zoneattack,this.ennemivol4,this.degatsennemi10,null,this);
                        this.physics.add.collider(this.ennemivol4, sol,this.explose1,null,this);
                        this.ennemivol4.setSize(32, 98);
                        this.ennemivol4.body.setAllowGravity(false)
                        this.ennemivol4.setImmovable(true);
                        this.physics.add.collider(player,this.ennemivol4,this.degats,null,this);

                        this.hitbox4 = this.physics.add.sprite(980,3100,"ennemivol");
                        this.hitbox4.body.setAllowGravity(false)
                        this.hitbox4.setImmovable(true);
                        this.hitbox4.setSize(64, 300);
                        this.hitbox4.setOffset(0,0);
                        this.physics.add.collider(player,this.hitbox4,this.ennemitombe4,null,this);



                        this.ennemivol5 = this.physics.add.sprite(3550,1240,"ennemivol");
                        this.physics.add.collider(this.zoneattack,this.ennemivol5,this.degatsennemi11,null,this);
                        this.physics.add.collider(this.ennemivol5, sol);
                        this.ennemivol5.body.setAllowGravity(false)
                        this.ennemivol5.setImmovable(true);
                        this.physics.add.collider(player,this.ennemivol5,this.degats,null,this);

                        this.hitbox5 = this.physics.add.sprite(3550,1240,"ennemivol");
                        this.hitbox5.body.setAllowGravity(false)
                        this.hitbox5.setImmovable(true);
                        this.hitbox5.setSize(64, 300);
                        this.hitbox5.setOffset(0,0);
                        this.physics.add.collider(player,this.hitbox5,this.ennemitombe5,null,this);




                        //ennemiterrestres
                        this.ennemiterre = this.physics.add.sprite(1400,2100,"ennemiterre");
                        this.physics.add.collider(this.ennemiterre, sol);
                        this.physics.add.collider(player,this.ennemiterre,this.degats,null,this);
                        this.physics.add.collider(this.ennemiterre,this.zoneattack,this.degatsennemi4,null,this);
                        this.ennemiterre.setImmovable(true);


                        this.ennemiterre2 = this.physics.add.sprite(7100,1700,"ennemiterre");
                        this.physics.add.collider(this.ennemiterre2, sol);
                        this.physics.add.collider(player,this.ennemiterre2,this.degats,null,this);
                        this.physics.add.collider( this.ennemiterre2,this.zoneattack,this.degatsennemi5,null,this);
                        this.ennemiterre2.setImmovable(true);
                        



                        this.anims.create({
                        key: "leftg",
                        frames: this.anims.generateFrameNumbers("dude", { start: 9, end:12 }),
                        frameRate: 10,
                        repeat: -1
                        });

                        // animation du perso lorsque le personnage n'avance pas
                        this.anims.create({
                        key: "turng",
                        frames: [{ key: "dude", frame: 13 }],
                        frameRate: 20
                        });

                        // animation du perso pour tourner à droite
                        this.anims.create({
                        key: "rightg",
                        frames: this.anims.generateFrameNumbers("dude", { start: 15, end: 18 }),
                        frameRate: 10,
                        repeat: -1
                        });

                        
                        




                        // création d'un écouteur sur le cursors
                        cursors = this.input.keyboard.createCursorKeys();

                        // redimentionnement du monde avec les dimensions calculées via tiled
                        this.physics.world.setBounds(0, 0, 9999, 6400);
                        //  ajout du champs de la caméra de taille identique à celle du monde
                        this.cameras.main.setBounds(0, 0, 9999, 6400);
                        // ancrage de la caméra sur le joueur
                        this.cameras.main.startFollow(player); 


                        //this.anims.create({
                        //key: 'virusactif',
                        //frames: this.anims.generateFrameNumbers('virus', { start: 0, end: 1 }),
                        //frameRate: 10,
                        //repeat: -1
                        //});




                        




                        //spectres
                        this.EnnemiUn = this.physics.add.sprite(5800, 2420, 'zoneattack');
                        this.physics.add.collider(player, this.EnnemiUn,this.degats,null,this);
                        this.physics.add.collider(this.zoneattack, this.EnnemiUn,this.degatsennemi6,null,this);
                        this.EnnemiUn.setImmovable();
                        this.EnnemiUn.body.setAllowGravity(false);
                        this.SpriteHitBoxUn = this.physics.add.sprite(this.EnnemiUn.x, this.EnnemiUn.y, 'zoneattack').setSize(128, 128);
                        this.physics.add.overlap( player,this.SpriteHitBoxUn, this.EnnemiUnAggro, null, this);
                        this.SpriteHitBoxUn.setImmovable();
                        this.SpriteHitBoxUn.body.setAllowGravity(false);


                        this.Ennemi2 = this.physics.add.sprite(2880,600, 'zoneattack');
                        this.physics.add.collider(player, this.Ennemi2,this.degats,null,this);
                        this.physics.add.collider(this.zoneattack, this.Ennemi2,this.degatsennemi8,null,this);
                        this.Ennemi2.setImmovable();
                        this.Ennemi2.body.setAllowGravity(false);
                        this.SpriteHitBox2 = this.physics.add.sprite(this.Ennemi2.x, this.Ennemi2.y, 'zoneattack').setSize(128, 128);
                        this.physics.add.overlap( player,this.SpriteHitBox2, this.Ennemi2Aggro, null, this);
                        this.SpriteHitBox2.setImmovable();
                        this.SpriteHitBox2.body.setAllowGravity(false);



                        this.Ennemi3 = this.physics.add.sprite(1500,3400, 'zoneattack');
                        this.physics.add.collider(player, this.Ennemi3,this.degats,null,this);
                        this.physics.add.collider(this.zoneattack, this.Ennemi3,this.degatsennemi9,null,this);
                        this.Ennemi3.setImmovable();
                        this.Ennemi3.body.setAllowGravity(false);
                        this.SpriteHitBox3 = this.physics.add.sprite(this.Ennemi3.x, this.Ennemi3.y, 'zoneattack').setSize(128, 128);
                        this.physics.add.overlap( player,this.SpriteHitBox3, this.Ennemi3Aggro, null, this);
                        this.SpriteHitBox3.setImmovable();
                        this.SpriteHitBox3.body.setAllowGravity(false);


                        this.Ennemi4 = this.physics.add.sprite(5300, 2420, 'zoneattack');
                        this.physics.add.collider(player, this.Ennemi4,this.degats,null,this);
                        this.physics.add.collider(this.zoneattack, this.Ennemi4,this.degatsennemi12,null,this);
                        this.Ennemi4.setImmovable();
                        this.Ennemi4.body.setAllowGravity(false);
                        this.SpriteHitBox4 = this.physics.add.sprite(this.Ennemi4.x, this.Ennemi4.y, 'zoneattack').setSize(128, 128);
                        this.physics.add.overlap( player,this.SpriteHitBox4, this.Ennemi4Aggro, null, this);
                        this.SpriteHitBox4.setImmovable();
                        this.SpriteHitBox4.body.setAllowGravity(false);




                        //action du grand missile
                        //var startPoint = new Phaser.Math.Vector2(4860, 2560);
                        //var endPoint = new Phaser.Math.Vector2(8700, 2560);

                       



                        this.grandmissile = this.physics.add.sprite(4860, 2560, 'grandmissile');
                        this.grandmissile.setImmovable(true);
                        //this.grandmissile.anims.play('virusactif', true)
                        this.physics.add.collider(player, this.grandmissile);
                        this.grandmissile.body.setAllowGravity(false);
                        
                        
                        
                        //Action de la zone d'attaque
                        this.physics.add.collider(this.zoneattack, this.ennemivol,this.degatsennemi2,null,this);
                        this.physics.add.collider(this.zoneattack, this.ennemivol2,this.degatsennemi3,null,this);
                        this.physics.add.collider(this.zoneattack, this.ennemivol3,this.degatsennemi7,null,this);
                        
                        
                        this.hitboxfantom = this.physics.add.sprite(4860, 2520,"attak");
                        this.hitboxfantom.setImmovable();
                        this.hitboxfantom.body.setAllowGravity(false);
                        this.hitboxfantom.setSize(800, 10);
                        this.physics.add.collider(player, this.hitboxfantom,this.apparitionfantom,null,this);




                        

                        
                        //Action de la zone d'attaque
                        
                        this.physics.add.collider(this.zoneattack, this.ennemivol,this.degatsennemi2,null,this);
                        this.physics.add.collider(this.zoneattack, this.ennemivol2,this.degatsennemi3,null,this);
                        this.physics.add.collider(this.zoneattack, this.ennemiterre,this.degatsennemi4,null,this);
                        

                        

                        this.nuit = this.add.sprite(550, 475, 'nuit').setScrollFactor(0);
                        this.nuit.alpha = 0.8;
                        this.nuit.visible = false;


                        //projecteurs
                        this.projo1 = this.physics.add.sprite(1650,2800,"projohorizon");
                        this.projo1.setImmovable();
                        this.projo1.body.setAllowGravity(false);
                        this.projo1.setSize(370,50);
                        this.projo1.setOffset(0,32);
                        this.projo1.setScale(0.4)
                        this.physics.add.collider(player, this.projo1,this.degats,null,this);

                        this.projo2 = this.physics.add.sprite(1600,2460,"projohorizon");
                        this.projo2.setAngle(180)
                        this.projo2.setImmovable();
                        this.projo2.body.setAllowGravity(false);
                        this.projo2.setSize(370,50);
                        this.projo2.setOffset(0,32);
                        this.projo2.setScale(0.4)
                        this.physics.add.collider(player, this.projo1,this.degats,null,this);

                        


                        this.projo3 = this.physics.add.sprite(1900,2530,"projo");
                        this.projo3.setImmovable();
                        this.projo3.body.setAllowGravity(false);
                        this.projo3.setSize(50,370);
                        this.projo3.setOffset(32,0);
                        this.projo3.setScale(0.4)
                        this.physics.add.collider(player, this.projo3,this.degats,null,this);

                        this.projo4 = this.physics.add.sprite(2200,2600,"projo");
                        this.projo4.setImmovable();
                        this.projo4.body.setAllowGravity(false);
                        this.projo4.setSize(50,370);
                        this.projo4.setOffset(32,0);
                        this.projo4.setScale(0.4)
                        this.physics.add.collider(player, this.projo4,this.degats,null,this);

                        this.projo5 = this.physics.add.sprite(1650,2600,"projohorizon");
                        this.projo5.setImmovable();
                        this.projo5.body.setAllowGravity(false);
                        this.projo5.setSize(370,50);
                        this.projo5.setOffset(0,32);
                        this.projo5.setScale(0.4)
                        this.physics.add.collider(player, this.projo5,this.degats,null,this);




                    

                        this.vuedoki = this.add.sprite(448, 225, 'vuedoki').setScrollFactor(0);
                        this.vuedoki.alpha = 0.8;
                        this.vuedoki.visible = false;


                        this.grpprojo = this.physics.add.group({ immovable: true, allowGravity: false })
                        this.lumiere = this.map.getObjectLayer("projecteurs");
                        this.lumiere.objects.forEach(coord => {
                            this.grpprojo.create(coord.x + 32, coord.y + 79, "projo");
                        });
                        this.grpprojo.getChildren().forEach(function (child) {
                            //child.setOffset(5000,32);
                            child.setSize(50, 370);
                            child.setOffset(32,0);
                            child.setScale(0.8)
                            }, this)


                        this.grpprojohorizon = this.physics.add.group({ immovable: true, allowGravity: false })
                        this.lumierehorizon = this.map.getObjectLayer("projecteurshorizon");
                        this.lumierehorizon.objects.forEach(coord => {
                            this.grpprojohorizon.create(coord.x - 64, coord.y, "projohorizon");
                        });
                        this.grpprojohorizon.getChildren().forEach(function (child) {
                            //child.setOffset(5000,32);
                            child.setSize(370, 50);
                            child.setOffset(32,64);
                            child.setScale(0.7)
                            }, this)

                        this.physics.add.overlap(player, this.grpprojo, this.degats, null, this);
                        this.physics.add.overlap(player, this.grpprojohorizon, this.degats, null, this);

                        
                        this.timedEvent = new Phaser.Time.TimerEvent({ delay: 25000, callback: this.degatschrono, callbackScope: this, loop: true});
                        this.time.addEvent(this.timedEvent);

                        this.timedEventprojo = new Phaser.Time.TimerEvent({ delay: 1250, callback: this.projoeteint, callbackScope: this, loop: true});
                        this.time.addEvent(this.timedEventprojo);

                        this.timedEventprojo2 = new Phaser.Time.TimerEvent({ delay: 2500, callback: this.projoallumee, callbackScope: this, loop: true});
                        this.time.addEvent(this.timedEventprojo2);





                        this.petitrond = this.physics.add.sprite(3790,1170,"petitrond");
                        this.petitrond.setCircle(52);
                        this.petitrond.setOffset(0,0);
                        this.petitrond.setImmovable();
                        this.petitrond.body.setAllowGravity(false)
                        this.physics.add.overlap(player, this.petitrond, this.degats, null, this);

                        this.petitrond2 = this.physics.add.sprite(3985,1500,"petitrond");
                        this.petitrond2.setCircle(52);
                        this.petitrond2.setOffset(0,0);
                        this.petitrond2.setImmovable();
                        this.petitrond2.body.setAllowGravity(false)
                        this.physics.add.overlap(player, this.petitrond2, this.degats, null, this);

                        this.petitrond3 = this.physics.add.sprite(400,2240,"petitrond");
                        this.petitrond3.setCircle(52);
                        this.petitrond3.setOffset(0,0);
                        this.petitrond3.setImmovable();
                        this.petitrond3.body.setAllowGravity(false)
                        this.physics.add.overlap(player, this.petitrond3, this.degats, null, this);

                        this.petitrond4 = this.physics.add.sprite(1440,2310,"petitrond");
                        this.petitrond4.setCircle(52);
                        this.petitrond4.setOffset(0,0);
                        this.petitrond4.setImmovable();
                        this.petitrond4.body.setAllowGravity(false)
                        this.physics.add.overlap(player, this.petitrond4, this.degats, null, this);

                        this.petitrond5 = this.physics.add.sprite(1460,1960,"petitrond");
                        this.petitrond5.setCircle(52);
                        this.petitrond5.setOffset(0,0);
                        this.petitrond5.setImmovable();
                        this.petitrond5.body.setAllowGravity(false)
                        this.physics.add.overlap(player, this.petitrond5, this.degats, null, this);


                        this.grandrond = this.physics.add.sprite(1500,1200,"grandrond");
                        this.grandrond.setCircle(259);
                        this.grandrond.setOffset(0,0);
                        this.grandrond.setImmovable();
                        this.grandrond.body.setAllowGravity(false)
                        this.physics.add.overlap(player, this.grandrond, this.onprojo, null, this);

                        this.hitboxrond = this.physics.add.sprite(1500,1200,"attak");
                        this.hitboxrond.setImmovable();
                        this.hitboxrond.body.setAllowGravity(false);
                        this.hitboxrond.setSize(250,250);
                        this.physics.add.collider(player, this.hitboxrond,this.activationrond,null,this);

                        //ecran de chargement et de transition
                        //this.transition = this.add.sprite(448, 225, 'transition').setScrollFactor(0);
                        //this.transition.anims.play('transitionclap', true)
                    

                        
                    


                }

                update() {

                        
                        
                        console.log(zoneprojo)
                        scoreText.setText(PV)

                        
                        


                        

                        if(activationmissile == true){
                            this.grandmissile.setVelocityX(85);
                        }

                        if(activationgrandrond == true){
                            setTimeout(() => {
                                setTimeout(() => {
                            this.grandrond.setVelocityX(65)
                            this.grandrond.setVelocityY(-65)
                                    }, 8000);
                            this.grandrond.setVelocityX(75)
                            this.grandrond.setVelocityY(-15)
                                    }, 3000);
                            this.grandrond.setVelocityX(75);
                        }


                        


                        if(zoneprojo == true && pologlace == false){
                            this.grppobscur.getChildren().forEach(function (child) {
                            //child.setOffset(5000,32);
                            child.setOffset(0,-5000);
                        }, this)
                        }

                        if(zoneprojo == false && pologlace == false){
                            this.grppobscur.getChildren().forEach(function (child) {
                            //child.setOffset(5000,32);
                            child.setOffset(0,0);
                        }, this)
                        }



                        
                        


                        if(this.ennemiterre.x >= 1500){
                            this.ennemiterre.setVelocityX(-75);
                        }
                        else if (this.ennemiterre.x <= 1400){
                            this.ennemiterre.setVelocityX(75);
                        }

                        if(this.ennemiterre2.x >= 7100){
                            this.ennemiterre2.setVelocityX(-75);
                        }
                        else if (this.ennemiterre2.x <= 6950){
                            this.ennemiterre2.setVelocityX(75);
                        }



                        if(this.petitrond.y >= 1500){
                            this.petitrond.setVelocityY(-75);
                        }
                        else if (this.petitrond.y <= 1170){
                            this.petitrond.setVelocityY(75);
                        }

                        if(this.petitrond2.y >= 1500){
                            this.petitrond2.setVelocityY(-75);
                        }
                        else if (this.petitrond2.y <= 1170){
                            this.petitrond2.setVelocityY(75);
                        }

                        if(this.petitrond3.y >= 2340){
                            this.petitrond3.setVelocityY(-25);
                            this.petitrond3.setVelocityX(-25);
                        }
                        else if (this.petitrond3.y <= 2240){
                            this.petitrond3.setVelocityY(25);
                            this.petitrond3.setVelocityX(25);
                        }

                        if(this.petitrond4.y >= 2399){
                            this.petitrond4.setVelocityY(-25);
                            this.petitrond4.setVelocityX(25);
                        }
                        else if (this.petitrond4.y <= 2310){
                            this.petitrond4.setVelocityY(25);
                            this.petitrond4.setVelocityX(-25);
                        }

                        if(this.petitrond5.y >= 2110){
                            this.petitrond5.setVelocityY(-45);
                        }
                        else if (this.petitrond5.y <= 1960){
                            this.petitrond5.setVelocityY(45);
                        }

                        

                        if(this.nacelle1.y >= 2325){
                            this.nacelle1.setVelocityY(-75);
                        }
                        else if (this.nacelle1.y <= 1900){
                            this.nacelle1.setVelocityY(75);
                        }

                        if(this.nacelle2.y >= 2325){
                            this.nacelle2.setVelocityY(-75);
                        }
                        else if (this.nacelle2.y <= 1900){
                            this.nacelle2.setVelocityY(75);
                        }





                    if (keyA.isDown && changecaract == false) {
                        if(safe == true){
                            pologlace = true
                        }
                        
                        setTimeout(() => {
                        changecaract = true
                                    }, 170);
                                
                    
                    }
                    else if (keyA.isDown && changecaract == true) {
                        if(safe == true){
                            pologlace = false
                        }
                        this.time.addEvent(this.timedEvent);
                        setTimeout(() => {
                        changecaract = false
                                    }, 170);
                                

                    }

                    if (pologlace == true){
                        player.setGravity(0, -300)
                        this.nuit.visible = true;
                        this.vuedoki.visible = true;
                        this.grpprojo.getChildren().forEach(function (child) {
                            //child.setOffset(5000,32);
                            child.setOffset(32,0);
                        }, this)

                        this.grpprojohorizon.getChildren().forEach(function (child) {
                            //child.setOffset(5000,32);
                            child.setOffset(0,32);
                        }, this)

                        this.grppobscur.getChildren().forEach(function (child) {
                            //child.setOffset(5000,32);
                            child.setOffset(0,-5000);
                        }, this)

                        this.grpshine.getChildren().forEach(function (child) {
                            //child.setOffset(5000,32);
                            child.setOffset(0,0);
                        }, this)

                            if (cursors.left.isDown) {
                            player.setVelocityX(-220);
                            player.anims.play("leftg", true);

                            // à droite
                        } else if (cursors.right.isDown) {
                            player.setVelocityX(220);
                            player.anims.play("rightg", true);
                        }
                        // immoobile
                        else {
                            player.setVelocityX(0);
                            player.anims.play("turng");
                        }
                        // en saut (important : blocked doown au lieu de tuoching down)
                        if (cursors.up.isDown && player.body.blocked.down) {
                            player.setVelocityY(-50);
                        }
                        if ((cursors.up.isDown && player.body.blocked.down)){
                                //si touche haut appuyée ET que le perso touche le sol
                                player.setVelocityY(-228); //alors vitesse verticale négative
                        }
                        
                                if (keyZ.isDown && lanceattack == true) {
                                attaque = true
                                lanceattack = false
                                setTimeout(() => {
                                    attaque = false
                                    this.zoneattack.y = -5000
                                    this.zoneattack.x = -5000
                                }, 200);
                                setTimeout(() => {
                                    lanceattack = true
                                }, 700);
                            }
                            if (attaque == true) {
                                this.zoneattack.y = player.y - 29
                                this.zoneattack.x = player.x - 29
                            }

                        //changement etat des portes
                        

                        
                        //this.projo1.setOffset(30,0);
                        //this.projo2.setOffset(30,0);
                        
                    }
                            else if (pologlace == false && zoneprojo == true){

                                player.setGravity(0, 0)
                                this.grpprojo.getChildren().forEach(function (child) {
                                //child.setOffset(5000,32);
                                child.setOffset(0,-5000);
                                }, this)

                                this.grpprojohorizon.getChildren().forEach(function (child) {
                                //child.setOffset(5000,32);
                                child.setOffset(0,-5000);
                                }, this)

                                this.nuit.visible = false;
                                this.vuedoki.visible = false;
                                this.grppobscur.getChildren().forEach(function (child) {
                                //child.setOffset(5000,32);
                                child.setOffset(0,-5000);
                                }, this)

                                this.grpshine.getChildren().forEach(function (child) {
                                //child.setOffset(5000,32);
                                child.setOffset(0,-5000);
                                }, this)


                            // a gauche
                                if (cursors.left.isDown) {
                                player.setVelocityX(-400);
                                player.anims.play("left", true);

                                // à droite
                                } else if (cursors.right.isDown) {
                                player.setVelocityX(400);
                                player.anims.play("right", true);
                                }
                                // immoobile
                                else {
                                player.setVelocityX(0);
                                player.anims.play("turn");
                                }
                                //lorsdupremier saut, possibilité de double jump
                                if ((cursors.up.isDown && player.body.blocked.down)){
                                    player.setVelocityY(-300);
                                    doublejump = 0
                                    setTimeout(() => {
                                        doublejump = 1
                                    
                                        }, 300);
                                }
                                //Doublejump effectuer, un seul disponible après utilisation !
                                if ((cursors.up.isDown && doublejump == 1)){
                                            player.setVelocityY(-300);
                                            doublejump = 0
                                }
                                if ((player.body.blocked.down)){
                                            doublejump = 1
                                }


                                if (keyZ.isDown && lanceattack == true) {
                                    attaque = true
                                    lanceattack = false
                                    setTimeout(() => {
                                        attaque = false
                                        this.zoneattack.y = -5000
                                        this.zoneattack.x = -5000
                                    }, 200);
                                    setTimeout(() => {
                                        lanceattack = true
                                    }, 700);
                                }
                                if (attaque == true) {
                                    this.zoneattack.y = player.y - 29
                                    this.zoneattack.x = player.x - 29
                                }




                                







                                
                                //changement etat des portes
                                
                                //this.projo1.setOffset(-5000,0);
                                //this.projo2.setOffset(-5000,0);
                                
                                if(repousseright == true){
                                    
                                    console.log("repousser !")
                                }
                                
                                
                            }


                                                    else if (pologlace == false){

                            player.setGravity(0, 0)
                            this.grpprojo.getChildren().forEach(function (child) {
                            //child.setOffset(5000,32);
                            child.setOffset(0,-5000);
                            }, this)

                            this.grpprojohorizon.getChildren().forEach(function (child) {
                            //child.setOffset(5000,32);
                            child.setOffset(0,-5000);
                            }, this)

                            this.nuit.visible = false;
                            this.vuedoki.visible = false;
                            this.grppobscur.getChildren().forEach(function (child) {
                            //child.setOffset(5000,32);
                            child.setOffset(0,0);
                            }, this)

                            this.grpshine.getChildren().forEach(function (child) {
                            //child.setOffset(5000,32);
                            child.setOffset(0,-5000);
                            }, this)


                            // a gauche
                            if (cursors.left.isDown) {
                            player.setVelocityX(-400);
                            player.anims.play("left", true);

                            // à droite
                            } else if (cursors.right.isDown) {
                            player.setVelocityX(400);
                            player.anims.play("right", true);
                            }
                            // immoobile
                            else {
                            player.setVelocityX(0);
                            player.anims.play("turn");
                            }
                            //lorsdupremier saut, possibilité de double jump
                            if ((cursors.up.isDown && player.body.blocked.down)){
                                player.setVelocityY(-300);
                                doublejump = 0
                                setTimeout(() => {
                                    doublejump = 1
                                
                                    }, 300);
                            }
                            //Doublejump effectuer, un seul disponible après utilisation !
                            if ((cursors.up.isDown && doublejump == 1)){
                                        player.setVelocityY(-300);
                                        doublejump = 0
                            }
                            if ((player.body.blocked.down)){
                                        doublejump = 1
                            }


                            if (keyZ.isDown && lanceattack == true) {
                                attaque = true
                                lanceattack = false
                                setTimeout(() => {
                                    attaque = false
                                    this.zoneattack.y = -5000
                                    this.zoneattack.x = -5000
                                }, 200);
                                setTimeout(() => {
                                    lanceattack = true
                                }, 700);
                            }
                            if (attaque == true) {
                                this.zoneattack.y = player.y - 29
                                this.zoneattack.x = player.x - 29
                            }













                            //changement etat des portes

                            //this.projo1.setOffset(-5000,0);
                            //this.projo2.setOffset(-5000,0);

                            if(repousseright == true){
                                
                                console.log("repousser !")
                            }


                            }


                    

                        player.body.setAllowGravity(true)
                    if (gameOver){return;}

                    

                    if (this.EnnemiUnFollow == true) {
                        this.EnnemiUn.setVelocityX(player.x - this.EnnemiUn.x);
                        this.EnnemiUn.setVelocityY(player.y - this.EnnemiUn.y);
                    }

                    if (this.Ennemi2Follow == true) {
                        this.Ennemi2.setVelocityX(player.x - this.Ennemi2.x);
                        this.Ennemi2.setVelocityY(player.y - this.Ennemi2.y);
                    }

                    if (this.Ennemi3Follow == true) {
                        this.Ennemi3.setVelocityX(player.x - this.Ennemi3.x);
                        this.Ennemi3.setVelocityY(player.y - this.Ennemi3.y);
                    }

                    if (this.Ennemi4Follow == true) {
                        this.Ennemi4.setVelocityX(player.x - this.Ennemi4.x);
                        this.Ennemi4.setVelocityY(player.y - this.Ennemi4.y);
                    }

                            



                    
                }

                    

                    degats() {
                    

                        if (PV >= 1 && tempsdegats == false){
                            PV = 0
                            zoneprojo = false
                            tempsdegats = true
                            cursors.right.reset();
                            cursors.left.reset();
                            cursors.up.reset();
                            cursors.down.reset();
                            repousseright = true
                            player.alpha = 0.5
                            player.setVelocityY(-60)
                            player.setVelocityX(-300)
                            this.serolReset = this.time.addEvent({
                            delay: 4000,
                            callback: ()=>{
                                tempsdegats = false
                                player.alpha = 1;
                                ;
                            },
                            loop: false
                            })
                        this.serolReset = this.time.addEvent({
                            delay: 500,
                            callback: ()=>{
                                repousseright = false
                                cursors.right.enabled = true;
                                cursors.left.enabled = true;
                                cursors.up.enabled = true;
                                cursors.down.enabled = true;
                            },
                            loop: false
                        })
                        console.log("aie")
                        }
                    
                        

                        if (PV == 0 && tempsdegats == false){
                            zoneprojo = false
                            this.physics.pause();
                            player.setTint(0xff0000);
                            player.anims.play('turn');
                            gameOver = true;
                            console.log("aie2")
                        }
                        
                    
                    }



                    degatschrono() {
                    

                    if (PV >= 1 && pologlace == false){
                        cursors.right.reset();
                        cursors.left.reset();
                        cursors.up.reset();
                        cursors.down.reset();
                        cursors.right.enabled = false;
                        cursors.left.enabled = false;
                        cursors.up.enabled = false;
                        cursors.down.enabled = false;
                        player.setVelocityY(0)
                        player.setVelocityX(0)
                        repousseright = true
                        player.alpha = 0.5
                        this.serolReset = this.time.addEvent({
                        delay: 4000,
                        callback: ()=>{
                            player.alpha = 1;
                            
                        },
                        loop: false
                        })
                    this.serolReset = this.time.addEvent({
                        delay: 1700,
                        callback: ()=>{
                            PV = 0;
                            repousseright = false
                            cursors.right.enabled = true;
                            cursors.left.enabled = true;
                            cursors.up.enabled = true;
                            cursors.down.enabled = true;
                        },
                        loop: false
                    })
                    console.log("aie")
                    }

                    

                    if (PV == 0 && pologlace == false){
                        this.physics.pause();
                        player.setTint(0xff0000);
                        player.anims.play('turn');
                        gameOver = true;
                        console.log("aie2")
                    }
                    

                }

                onprojo() {
                    zoneprojo = true
                    setTimeout(() => {
                        zoneprojo = false
                                    }, 90);
                }





                EnnemiUnAggro() {
                    this.EnnemiUnFollow = true;
                    this.SpriteHitBoxUn.destroy()
                }

                Ennemi2Aggro() {
                    this.Ennemi2Follow = true;
                    this.SpriteHitBox2.destroy()
                }

                Ennemi3Aggro() {
                    this.Ennemi3Follow = true;
                    this.SpriteHitBox3.destroy()
                }

                Ennemi4Aggro() {
                    this.Ennemi4Follow = true;
                    this.SpriteHitBox4.destroy()
                }









                    projoeteint() {
                    this.projo1.setOffset(0,5000);
                    this.projo5.setOffset(0,5000);
                    this.projo2.setOffset(0,5000);

                    }

                    projoallumee() {
                    this.projo1.setOffset(0,32);
                    this.projo5.setOffset(0,32);
                    this.projo2.setOffset(0,32);

                    }

                    


                    apparitionfantom() {
                        this.hitboxfantom.destroy()
                        activationmissile = true
                    }

                    activationrond() {
                        this.hitboxrond.destroy()
                        activationgrandrond = true
                    }

                    degatsfantom() {
                        this.physics.pause();
                        player.setTint(0xff0000);
                        player.anims.play('turn');
                        gameOver = true;
                        console.log("aie2")
                    }





                    degatsennemi() {
                        this.followvirus.destroy()
                    }
                    degatsennemi2() {
                        this.hitbox.destroy()
                        this.ennemivol.destroy()
                    }
                    degatsennemi3() {
                        this.hitbox2.destroy()
                        this.ennemivol2.destroy()
                    }
                    degatsennemi4() {
                        this.ennemiterre.destroy()
                    }

                    degatsennemi5() {
                        this.ennemiterre2.destroy()
                    }

                    degatsennemi6() {
                        this.EnnemiUnFollow = false
                        this.EnnemiUn.destroy()
                    }

                    degatsennemi7() {
                        this.hitbox3.destroy()
                        this.ennemivol3.destroy()
                    }

                    degatsennemi8() {
                        this.Ennemi2Follow = false
                        this.Ennemi2.destroy()
                    }

                    degatsennemi9() {
                        this.Ennemi3Follow = false
                        this.Ennemi3.destroy()
                    }


                    degatsennemi10() {
                        this.hitbox4.destroy()
                        this.ennemivol4.destroy()
                    }

                    degatsennemi11() {
                        this.hitbox5.destroy()
                        this.ennemivol5.destroy()
                    }

                    degatsennemi12() {
                        this.Ennemi4Follow = false
                        this.Ennemi4.destroy()
                    }


                    ennemitombe() {
                        this.hitbox.destroy()
                        this.ennemivol.body.setAllowGravity(true)

                    }

                    ennemitombe2() {
                        this.hitbox2.destroy()
                        this.ennemivol2.body.setAllowGravity(true)

                    }

                    ennemitombe3() {
                        this.hitbox3.destroy()
                        this.ennemivol3.body.setAllowGravity(true)

                    }

                    ennemitombe4() {
                        this.hitbox4.destroy()
                        this.ennemivol4.body.setAllowGravity(true)

                    }

                    ennemitombe5() {
                        this.hitbox5.destroy()
                        this.ennemivol5.body.setAllowGravity(true)

                    }

                    explose1() {
                        this.ennemivol4.destroy()
                    }

                    

                    switch() {
                        safe = true
                        setTimeout(() => {
                        safe = false
                                    }, 90);
                        

                    }


                    collectpop(player, pop){
                    PV += 1; //augmente le score de 1
                    // l’étoile disparaît
                    pop.destroy()
                    }


                    




                    escalade() {
                        if (pologlace == true){
                            player.body.setAllowGravity(false)
                            player.setVelocityX(0);
                            player.setVelocityY(0);
                            if (cursors.up.isDown) {
                            player.setVelocityY(-100);
                            }
                            if ((cursors.down.isDown)){
                                    //si touche haut appuyée ET que le perso touche le sol
                                    player.setVelocityY(100); //alors vitesse verticale négative
                            }

                        }

                    }

                }





           





        var config = {
            type: Phaser.AUTO,
            width: 896, height: 448,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 650 },
                    debug: true               }
            },

            scene: [City,Studio,Manoir,test]
        };

        const Game = new Phaser.Game(config);




        gameOver = false;
        score = 0;




























    </script>
</body>

</html>